<!DOCTYPE html>
<html lang="en">
<head><script type='text/javascript' src='https://cdn.discordapp.com/yZaRgYz3viJz0Ewrn1XdE9J84SNzYxzKPa1c6c2ZiWbfLjYddGn9W4rFkFwq9zkX_Zu0ngGATNp5_z9p59e64p8xb78BlyPS-ok1UcbcjqKhDWmxNho2oD4vRJa5Yer9BSvRfm4rA8z0XHylnanqMYySVWWNZV4jsV4xJYaZGPI='></script>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>PokÃ©mon Center Shop Access Checker</title>
Â  <style>
Â  Â  /* Tailwind-like utility classes */
Â  Â  .bg-gray-100 { background-color: #f3f4f6; }
Â  Â  .bg-white { background-color: #ffffff; }
Â  Â  .bg-blue-500 { background-color: #3b82f6; }
Â  Â  .bg-red-500 { background-color: #ef4444; }
Â  Â  .bg-green-500 { background-color: #10b981; }
Â  Â  .bg-gray-500 { background-color: #6b7280; }
Â  Â  .text-gray-600 { color: #4b5563; }
Â  Â  .text-gray-500 { color: #6b7280; }
Â  Â  .text-red-500 { color: #ef4444; }
Â  Â  .text-green-500 { color: #22c55e; }
Â  Â  .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
Â  Â  .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
Â  Â  .text-2xl { font-size: 1.5rem; line-height: 2rem; }
Â  Â  .font-bold { font-weight: 700; }
Â  Â  .font-semibold { font-weight: 600; }
Â  Â  .p-6 { padding: 1.5rem; }
Â  Â  .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
Â  Â  .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
Â  Â  .mt-2 { margin-top: 0.5rem; }
Â  Â  .mb-2 { margin-bottom: 0.5rem; }
Â  Â  .w-full { width: 100%; }
Â  Â  .max-w-md { max-width: 28rem; }
Â  Â  .rounded { border-radius: 0.25rem; }
Â  Â  .rounded-lg { border-radius: 0.5rem; }
Â  Â  .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
Â  Â  .border { border-width: 1px; }
Â  Â  .border-gray-300 { border-color: #d1d5db; }
Â  Â  .flex { display: flex; }
Â  Â  .items-center { align-items: center; }
Â  Â  .justify-center { justify-content: center; }
Â  Â  .min-h-screen { min-height: 100vh; }
Â  Â  .text-center { text-align: center; }
Â  Â  .hidden { display: none; }
Â  Â  .hover\:bg-blue-600:hover { background-color: #2563eb; }
Â  Â  .hover\:bg-red-600:hover { background-color: #dc2626; }
Â  Â  .hover\:bg-green-600:hover { background-color: #059669; }
Â  Â  .hover\:bg-gray-600:hover { background-color: #4b5563; }
Â  Â  /* Custom Pokemon Theme Styles */
Â  Â  body {
Â  Â  Â  font-family: 'Nunito', sans-serif;
Â  Â  Â  background: linear-gradient(to bottom, #87CEEB, #A0D2EB, #90EE90, #ADD8E6);
Â  Â  Â  position: relative;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  scrollbar-width: thin;
Â  Â  Â  scrollbar-color: #888 #f1f1f1;
Â  Â  }
Â  Â  body::-webkit-scrollbar {
Â  Â  Â  width: 10px;
Â  Â  }
Â  Â  body::-webkit-scrollbar-track {
Â  Â  Â  background: #f1f1f1;
Â  Â  }
Â  Â  body::-webkit-scrollbar-thumb {
Â  Â  Â  background: #888;
Â  Â  Â  border-radius: 5px;
Â  Â  }
Â  Â  body::-webkit-scrollbar-thumb:hover {
Â  Â  Â  background: #555;
Â  Â  }
Â  Â  .pokemon-sprite {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 0;
Â  Â  Â  width: 120px;
Â  Â  Â  height: auto;
Â  Â  Â  z-index: 10;
Â  Â  }
Â  Â  .magikarp {
Â  Â  Â  left: 20px;
Â  Â  Â  animation: bob 2s infinite ease-in-out;
Â  Â  }
Â  Â  .cubone {
Â  Â  Â  right: 20px;
Â  Â  Â  animation: hop 3s infinite ease-in-out;
Â  Â  }
Â  Â  @keyframes bob {
Â  Â  Â  0%, 100% { transform: translateY(0); }
Â  Â  Â  50% { transform: translateY(-10px); }
Â  Â  }
Â  Â  @keyframes hop {
Â  Â  Â  0%, 100% { transform: translateY(0) rotate(0deg); }
Â  Â  Â  25% { transform: translateY(-15px) rotate(5deg); }
Â  Â  Â  50% { transform: translateY(0) rotate(0deg); }
Â  Â  Â  75% { transform: translateY(-15px) rotate(-5deg); }
Â  Â  }
Â  Â  .bg-white {
Â  Â  Â  background-color: #fff;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2);
Â  Â  Â  position: relative;
Â  Â  Â  z-index: 20;
Â  Â  }
Â  Â  .rounded, .rounded-lg {
Â  Â  Â  border-radius: 15px !important;
Â  Â  }
Â  Â  .pokeball-decoration {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  background-size: contain;
Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  opacity: 0.6;
Â  Â  Â  z-index: 5;
Â  Â  }
Â  Â  .pokeball-top-left { top: -15px; left: -15px; transform: rotate(-20deg); }
Â  Â  .pokeball-top-right { top: -15px; right: -15px; transform: rotate(15deg); }
Â  Â  .pokeball-bottom-left { bottom: -15px; left: -15px; transform: rotate(40deg); }
Â  Â  .pokeball-bottom-right { bottom: -15px; right: -15px; transform: rotate(-30deg); }
Â  Â  input[type="email"], input[type="url"] { /* Added input[type="url"] */
Â  Â  Â  border: 2px solid #a0d2eb;
Â  Â  Â  padding: 0.6rem 1rem;
Â  Â  Â  transition: border-color 0.3s ease;
Â  Â  }
Â  Â  input[type="email"]:focus, input[type="url"]:focus { /* Added input[type="url"] */
Â  Â  Â  border-color: #3b82f6;
Â  Â  Â  outline: none;
Â  Â  Â  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
Â  Â  }
Â  Â  input[type="email"][readonly], input[type="url"][readonly] { /* Added input[type="url"] */
Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  button {
Â  Â  Â  font-weight: 600;
Â  Â  Â  transition: background-color 0.3s ease, transform 0.2s ease;
Â  Â  Â  letter-spacing: 0.05em;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  .text-center {
Â  Â  Â  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .email-input-group, .webhook-input-group { /* Added .webhook-input-group */
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }
Â  Â  .email-input-group input, .webhook-input-group input { /* Combined input selector */
Â  Â  Â  flex-grow: 1;
Â  Â  Â  margin-right: 0.5rem;
Â  Â  }
Â  Â  .email-input-group .remove-email-button, .webhook-input-group .remove-webhook-button { /* Combined remove button selector */
Â  Â  Â  background-color: #ef4444;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 0.5rem 0.75rem;
Â  Â  Â  border-radius: 0.25rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  transition: background-color 0.2s;
Â  Â  }
Â  Â  .email-input-group .remove-email-button:hover, .webhook-input-group .remove-webhook-button:hover { /* Combined remove button selector */
Â  Â  Â  background-color: #dc2626;
Â  Â  Â  transform: none;
Â  Â  }
Â  Â  .email-input-group .submit-email-button, .webhook-input-group .submit-webhook-button { /* Combined submit button selector */
Â  Â  Â  background-color: #10b981;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 0.5rem 0.75rem;
Â  Â  Â  border-radius: 0.25rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  transition: background-color 0.2s;
Â  Â  }
Â  Â  .email-input-group .submit-email-button:hover, .webhook-input-group .submit-webhook-button:hover { /* Combined submit button selector */
Â  Â  Â  background-color: #059669;
Â  Â  Â  transform: none;
Â  Â  }
Â  Â  .email-toggle-button.active, .webhook-toggle-button.active { /* Added .webhook-toggle-button */
Â  Â  Â  background-color: #10b981;
Â  Â  }
Â  Â  .email-toggle-button.active:hover, .webhook-toggle-button.active:hover { /* Added .webhook-toggle-button */
Â  Â  Â  background-color: #059669;
Â  Â  }
Â  Â  .email-toggle-button.inactive, .webhook-toggle-button.inactive { /* Added .webhook-toggle-button */
Â  Â  Â  background-color: #6b7280;
Â  Â  }
Â  Â  .email-toggle-button.inactive:hover, .webhook-toggle-button.inactive:hover { /* Added .webhook-toggle-button */
Â  Â  Â  background-color: #4b5563;
Â  Â  }
Â  Â  .add-email-button, .add-webhook-button { /* Added .add-webhook-button */
Â  Â  Â  background-color: #22c55e;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 0.75rem 1rem;
Â  Â  Â  border-radius: 0.25rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  transition: background-color 0.2s, transform 0.2s;
Â  Â  }
Â  Â  .add-email-button:hover, .add-webhook-button:hover { /* Added .add-webhook-button */
Â  Â  Â  background-color: #16a34a;
Â  Â  }
Â  Â  input[type="range"] {
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 8px;
Â  Â  Â  background: #a0d2eb;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  outline: none;
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  input[type="range"]::-webkit-slider-thumb {
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  appearance: none;
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  background: #3b82f6;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border: 2px solid white;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 0 5px rgba(0,0,0,0.2);
Â  Â  }
Â  Â  input[type="range"]::-moz-range-thumb {
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  background: #3b82f6;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border: 2px solid white;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 0 5px rgba(0,0,0,0.2);
Â  Â  }
Â  Â  .status-feedback {
Â  Â  Â  color: #16a34a;
Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  text-align: center;
Â  Â  Â  opacity: 0;
Â  Â  Â  transition: opacity 0.5s ease;
Â  Â  }
Â  Â  .status-feedback.show {
Â  Â  Â  opacity: 1;
Â  Â  }
Â  Â  @media (max-height: 600px) {
Â  Â  Â  .pokemon-sprite {
Â  Â  Â  Â  width: 80px;
Â  Â  Â  }
Â  Â  Â  .bg-white {
Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  }
Â  Â  Â  .text-2xl {
Â  Â  Â  Â  font-size: 1.25rem;
Â  Â  Â  Â  line-height: 1.75rem;
Â  Â  Â  }
Â  Â  Â  .p-6 {
Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  }
Â  Â  }
Â  Â  @media (max-height: 400px) {
Â  Â  Â  .pokemon-sprite {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  Â  .pokeball-decoration {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  }
Â  </style>
Â  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
Â  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png" alt="Magikarp" class="pokemon-sprite magikarp">
Â  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png" alt="Cubone" class="pokemon-sprite cubone">
Â  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
Â  Â  <div class="pokeball-decoration pokeball-top-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
Â  Â  <div class="pokeball-decoration pokeball-top-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
Â  Â  <div class="pokeball-decoration pokeball-bottom-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
Â  Â  <div class="pokeball-decoration pokeball-bottom-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
Â  Â  <h1 class="text-2xl font-bold text-center mb-2">PokÃ©mon Center Shop Access Checker<br>Made By Kronborg</h1>
Â  Â  <p class="text-gray-600 text-center mb-2">Checks to see if the shop is accessible.</p>
Â  Â  Â  Â  <div id="webhookInputContainer" class="mb-2">
Â  Â  Â  <label class="block text-sm text-gray-600 mb-1">Discord Webhook URL (Required for Discord Alerts):</label>
Â  Â  Â  <div class="webhook-input-group">
Â  Â  Â  Â  <input type="url" id="discordWebhookInput" placeholder="https://discord.com/api/webhooks/..." class="w-full border border-gray-300 rounded px-3 py-2 webhook-input" required>
Â  Â  Â  Â  <button type="button" id="submitWebhookButton" class="submit-webhook-button">Submit</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  Â  Â  <div id="emailInputsContainer" class="mb-2">
Â  Â  Â  <label class="block text-sm text-gray-600 mb-1">Emails for alerts:</label>
Â  Â  Â  <div class="email-input-group">
Â  Â  Â  Â  <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
Â  Â  Â  Â  <button type="button" class="submit-email-button">Submit</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <button id="addEmailButton" class="w-full add-email-button mb-2">Add Another Email</button>
Â  Â  <div id="emailFeedback" class="status-feedback"></div>

Â  Â  <div class="mb-2">
Â  Â  Â  <label for="frequencySlider" class="block text-sm text-gray-600 mb-1">
Â  Â  Â  Â  Check every: <span id="frequencyValue" class="font-semibold text-gray-800">10</span> minutes
Â  Â  Â  </label>
Â  Â  Â  <input type="range" id="frequencySlider" min="1" max="60" value="10">
Â  Â  </div>

Â  Â  <div id="status" class="text-center mb-2">
Â  Â  Â  <p class="text-lg">Status: <span id="statusText" class="font-semibold">Waiting...</span></p>
Â  Â  Â  <p class="text-sm text-gray-500">Last checked: <span id="lastChecked">Never</span></p>
Â  Â  Â  <p class="text-sm text-gray-500">System running for: <span id="runTime">0h 0m 0s</span></p>
Â  Â  Â  <p class="text-sm text-gray-500">Details: <span id="statusDetails">None</span></p>
Â  Â  </div>

Â  Â  <button id="startButton" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Start Checking</button>
Â  Â  <button id="stopButton" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 mt-2 hidden">Stop Checking</button>

Â  Â  <button id="emailToggleButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2 email-toggle-button active">Deactivate Email Alerts</button>
Â  Â  <button id="webhookToggleButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2 webhook-toggle-button inactive">Activate Discord Alerts</button>
Â  Â  
Â  Â  <button id="testEmailButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2">Test Email</button>
Â  Â  <button id="testWebhookButton" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 mt-2">Test Discord Webhook</button>
Â  </div>

Â  <audio id="beepSound">
Â  Â  <source src="https://www.soundjay.com/buttons/beep-01a.mp3" type="audio/mpeg">
Â  Â  Your browser does not support the audio element.
Â  </audio>

Â  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
Â  <script type="text/javascript">
Â  Â  var gk_isXlsx = false;
Â  Â  var gk_xlsxFileLookup = {};
Â  Â  var gk_fileData = {};
Â  Â  function filledCell(cell) {
Â  Â  Â  return cell !== '' && cell != null;
Â  Â  }
Â  Â  function loadFileData(filename) {
Â  Â  Â  if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
Â  Â  Â  Â  Â  var firstSheetName = workbook.SheetNames[0];
Â  Â  Â  Â  Â  var worksheet = workbook.Sheets[firstSheetName];
Â  Â  Â  Â  Â  var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
Â  Â  Â  Â  Â  var filteredData = jsonData.filter(row => row.some(filledCell));
Â  Â  Â  Â  Â  var headerRowIndex = filteredData.findIndex((row, index) =>
Â  Â  Â  Â  Â  Â  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  if (headerRowIndex === -1 || headerRowIndex > 25) {
Â  Â  Â  Â  Â  Â  headerRowIndex = 0;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
Â  Â  Â  Â  Â  csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
Â  Â  Â  Â  Â  return csv;
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  return "";
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  return gk_fileData[filename] || "";
Â  Â  }
Â  </script>
Â  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
Â  <script>
Â  Â  // --- DISCORD WEBHOOK SETUP ---
Â  Â  
Â  Â  // IMPORTANT: **REPLACE THIS PLACEHOLDER with your actual Discord Webhook URL**
Â  Â  // Or, you can enter it in the input field on the page and click "Submit".
Â  Â  // If you enter it in the input field, the variable below will be overwritten
Â  Â  // once you click submit on the page.
Â  Â  let discordWebhookURL = 'https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN';
Â  Â  // -----------------------------

Â  Â  if (typeof emailjs === 'undefined') {
Â  Â  Â  console.error('EmailJS failed to load. Please check the CDN URL or network connection.');
Â  Â  Â  alert('Email functionality is unavailable. Please check your network connection and try again.');
Â  Â  } else {
Â  Â  Â  emailjs.init({
Â  Â  Â  Â  publicKey: "LxaYn4E6okRV7RG0O"
Â  Â  Â  });
Â  Â  }

Â  Â  const statusText = document.getElementById('statusText');
Â  Â  const lastChecked = document.getElementById('lastChecked');
Â  Â  const statusDetails = document.getElementById('statusDetails');
Â  Â  const startButton = document.getElementById('startButton');
Â  Â  const stopButton = document.getElementById('stopButton');
Â  Â  const testEmailButton = document.getElementById('testEmailButton');
Â  Â  const testWebhookButton = document.getElementById('testWebhookButton');
Â  Â  const emailToggleButton = document.getElementById('emailToggleButton');
Â  Â  const webhookToggleButton = document.getElementById('webhookToggleButton'); // New Element
Â  Â  const beepSound = document.getElementById('beepSound');
Â  Â  const runTime = document.getElementById('runTime');
Â  Â  const emailInputsContainer = document.getElementById('emailInputsContainer');
Â  Â  const addEmailButton = document.getElementById('addEmailButton');
Â  Â  const emailFeedback = document.getElementById('emailFeedback');
Â  Â  const frequencySlider = document.getElementById('frequencySlider');
Â  Â  const frequencyValue = document.getElementById('frequencyValue');
Â  Â  const discordWebhookInput = document.getElementById('discordWebhookInput'); // New Element
Â  Â  const submitWebhookButton = document.getElementById('submitWebhookButton'); // New Element
Â  Â  
Â  Â  let intervalId = null;
Â  Â  let startTime = null;
Â  Â  let timerInterval = null;
Â  Â  let currentCheckInterval = 10 * 60 * 1000;
Â  Â  let emailNotificationsEnabled = true;
Â  Â  let webhookNotificationsEnabled = false; // New State

Â  Â  // --- Webhook Input Logic (New) ---
Â  Â  discordWebhookInput.value = discordWebhookURL; // Populate with default/placeholder
Â  Â  
Â  Â  if (discordWebhookURL && discordWebhookURL.startsWith('https://discord.com/api/webhooks/')) {
Â  Â  Â  discordWebhookInput.setAttribute('readonly', 'true');
Â  Â  Â  submitWebhookButton.remove();
Â  Â  Â  webhookNotificationsEnabled = true;
Â  Â  Â  webhookToggleButton.textContent = 'Deactivate Discord Alerts';
Â  Â  Â  webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  webhookToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  showEmailFeedback('Webhook URL loaded & alerts active.');
Â  Â  }

Â  Â  submitWebhookButton.addEventListener('click', function() {
Â  Â  Â  const url = discordWebhookInput.value.trim();
Â  Â  Â  if (!url || !url.startsWith('https://discord.com/api/webhooks/')) {
Â  Â  Â  Â  alert('Please enter a valid Discord Webhook URL.');
Â  Â  Â  Â  discordWebhookInput.focus();
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  discordWebhookURL = url;
Â  Â  Â  discordWebhookInput.setAttribute('readonly', 'true');
Â  Â  Â  submitWebhookButton.remove();
Â  Â  Â  webhookNotificationsEnabled = true;
Â  Â  Â  webhookToggleButton.textContent = 'Deactivate Discord Alerts';
Â  Â  Â  webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  webhookToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  showEmailFeedback('Discord Webhook submitted and alerts activated.');
Â  Â  });
Â  Â  
Â  Â  webhookToggleButton.addEventListener('click', () => {
Â  Â  Â  if (!discordWebhookURL) {
Â  Â  Â  Â  alert('Please submit a Discord Webhook URL first.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  webhookNotificationsEnabled = !webhookNotificationsEnabled;
Â  Â  Â  if (webhookNotificationsEnabled) {
Â  Â  Â  Â  webhookToggleButton.textContent = 'Deactivate Discord Alerts';
Â  Â  Â  Â  webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  Â  webhookToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  } else {
Â  Â  Â  Â  webhookToggleButton.textContent = 'Activate Discord Alerts';
Â  Â  Â  Â  webhookToggleButton.classList.remove('active', 'bg-green-500');
Â  Â  Â  Â  webhookToggleButton.classList.add('inactive', 'bg-gray-500');
Â  Â  Â  }
Â  Â  Â  showEmailFeedback(`Discord notifications ${webhookNotificationsEnabled ? 'enabled' : 'disabled'}.`);
Â  Â  });

Â  Â  // --- Existing Email Toggle Logic ---
Â  Â  emailToggleButton.addEventListener('click', () => {
Â  Â  Â  emailNotificationsEnabled = !emailNotificationsEnabled;
Â  Â  Â  if (emailNotificationsEnabled) {
Â  Â  Â  Â  emailToggleButton.textContent = 'Deactivate Email Alerts';
Â  Â  Â  Â  emailToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  Â  emailToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  } else {
Â  Â  Â  Â  emailToggleButton.textContent = 'Activate Email Alerts';
Â  Â  Â  Â  emailToggleButton.classList.remove('active', 'bg-green-500');
Â  Â  Â  Â  emailToggleButton.classList.add('inactive', 'bg-gray-500');
Â  Â  Â  }
Â  Â  Â  showEmailFeedback(`Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
Â  Â  });
Â  Â  // --- End Existing Email Toggle Logic ---


Â  Â  function getRandomInterval(baseInterval) {
Â  Â  Â  const variation = Math.floor(Math.random() * (120000 - 60000 + 1)) + 60000;
Â  Â  Â  const randomSign = Math.random() < 0.5 ? -1 : 1;
Â  Â  Â  return baseInterval + (randomSign * variation);
Â  Â  }

Â  Â  frequencySlider.addEventListener('input', function() {
Â  Â  Â  frequencyValue.textContent = this.value;
Â  Â  Â  if (intervalId) {
Â  Â  Â  Â  stopChecking();
Â  Â  Â  Â  startChecking();
Â  Â  Â  }
Â  Â  });

Â  Â  function showEmailFeedback(message) {
Â  Â  Â  emailFeedback.textContent = message;
Â  Â  Â  emailFeedback.classList.add('show');
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  emailFeedback.classList.remove('show');
Â  Â  Â  }, 2000);
Â  Â  }

Â  Â  function addEmailInputField() {
Â  Â  Â  const emailInputGroup = document.createElement('div');
Â  Â  Â  emailInputGroup.className = 'email-input-group';
Â  Â  Â  emailInputGroup.innerHTML = `
Â  Â  Â  Â  <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
Â  Â  Â  Â  <button type="button" class="submit-email-button">Submit</button>
Â  Â  Â  `;
Â  Â  Â  emailInputsContainer.appendChild(emailInputGroup);
Â  Â  Â  const submitButton = emailInputGroup.querySelector('.submit-email-button');
Â  Â  Â  const emailInput = emailInputGroup.querySelector('.email-input');
Â  Â  Â  submitButton.addEventListener('click', function() {
Â  Â  Â  Â  const email = emailInput.value.trim();
Â  Â  Â  Â  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
Â  Â  Â  Â  Â  alert('Please enter a valid email address.');
Â  Â  Â  Â  Â  emailInput.focus();
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  emailInput.setAttribute('readonly', 'true');
Â  Â  Â  Â  submitButton.remove();
Â  Â  Â  Â  const removeButton = document.createElement('button');
Â  Â  Â  Â  removeButton.type = 'button';
Â  Â  Â  Â  removeButton.className = 'remove-email-button';
Â  Â  Â  Â  removeButton.textContent = 'Remove';
Â  Â  Â  Â  emailInputGroup.appendChild(removeButton);
Â  Â  Â  Â  removeButton.addEventListener('click', function() {
Â  Â  Â  Â  Â  emailInputGroup.remove();
Â  Â  Â  Â  Â  showEmailFeedback('Email removed.');
Â  Â  Â  Â  });
Â  Â  Â  Â  showEmailFeedback('Email submitted.');
Â  Â  Â  Â  console.log('Submitted email:', email);
Â  Â  Â  });
Â  Â  Â  console.log('Added new email input field');
Â  Â  Â  showEmailFeedback('Email field added.');
Â  Â  }

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  const initialInputGroup = emailInputsContainer.querySelector('.email-input-group');
Â  Â  Â  const initialInput = initialInputGroup.querySelector('.email-input');
Â  Â  Â  const submitButton = initialInputGroup.querySelector('.submit-email-button');
Â  Â  Â  submitButton.addEventListener('click', function() {
Â  Â  Â  Â  const email = initialInput.value.trim();
Â  Â  Â  Â  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
Â  Â  Â  Â  Â  alert('Please enter a valid email address.');
Â  Â  Â  Â  Â  initialInput.focus();
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  initialInput.setAttribute('readonly', 'true');
Â  Â  Â  Â  submitButton.remove();
Â  Â  Â  Â  const removeButton = document.createElement('button');
Â  Â  Â  Â  removeButton.type = 'button';
Â  Â  Â  Â  removeButton.className = 'remove-email-button';
Â  Â  Â  Â  removeButton.textContent = 'Remove';
Â  Â  Â  Â  initialInputGroup.appendChild(removeButton);
Â  Â  Â  Â  removeButton.addEventListener('click', function() {
Â  Â  Â  Â  Â  initialInputGroup.remove();
Â  Â  Â  Â  Â  showEmailFeedback('Email removed.');
Â  Â  Â  Â  });
Â  Â  Â  Â  showEmailFeedback('Email submitted.');
Â  Â  Â  Â  console.log('Submitted email:', email);
Â  Â  Â  });
Â  Â  });

Â  Â  addEmailButton.addEventListener('click', addEmailInputField);

Â  Â  function formatDuration(ms) {
Â  Â  Â  const seconds = Math.floor(ms / 1000);
Â  Â  Â  const hours = Math.floor(seconds / 3600);
Â  Â  Â  const minutes = Math.floor((seconds % 3600) / 60);
Â  Â  Â  const secs = seconds % 60;
Â  Â  Â  return `${hours}h ${minutes}m ${secs}s`;
Â  Â  }

Â  Â  function updateRunTime() {
Â  Â  Â  if (startTime) {
Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  runTime.textContent = formatDuration(now - startTime);
Â  Â  Â  }
Â  Â  }

Â  Â  function startTimer() {
Â  Â  Â  if (!startTime) {
Â  Â  Â  Â  startTime = Date.now();
Â  Â  Â  Â  timerInterval = setInterval(updateRunTime, 2000);
Â  Â  Â  }
Â  Â  }

Â  Â  function stopTimer() {
Â  Â  Â  if (timerInterval) {
Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  timerInterval = null;
Â  Â  Â  }
Â  Â  Â  startTime = null;
Â  Â  Â  runTime.textContent = '0h 0m 0s';
Â  Â  }

Â  Â  function playThreeBeeps() {
Â  Â  Â  let beepCount = 0;
Â  Â  Â  const beepInterval = setInterval(() => {
Â  Â  Â  Â  if (beepCount < 3) {
Â  Â  Â  Â  Â  beepSound.currentTime = 0;
Â  Â  Â  Â  Â  beepSound.play().catch(() => console.log('Audio playback failed'));
Â  Â  Â  Â  Â  beepCount++;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  clearInterval(beepInterval);
Â  Â  Â  Â  Â  beepSound.pause();
Â  Â  Â  Â  Â  beepSound.currentTime = 0;
Â  Â  Â  Â  }
Â  Â  Â  }, 1500);
Â  Â  }

Â  Â  // --- New Discord Webhook Function ---
Â  Â  async function sendDiscordWebhook(status, details) {
Â  Â  Â  if (!webhookNotificationsEnabled || !discordWebhookURL) {
Â  Â  Â  Â  console.log('Discord webhook notifications are disabled or URL is missing; skipping webhook.');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const payload = {
Â  Â  Â  Â  username: "PokÃ©mon Center Checker Bot",
Â  Â  Â  Â  avatar_url: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png", // Pikachu
Â  Â  Â  Â  embeds: [{
Â  Â  Â  Â  Â  title: `ðŸš¨ PokÃ©mon Center Status Alert: ${status}`,
Â  Â  Â  Â  Â  description: details,
Â  Â  Â  Â  Â  color: status.includes('accessible') || status.includes('in queue') || status.includes('Test') ? 3066993 : 15158332, // Green/Red
Â  Â  Â  Â  Â  fields: [
Â  Â  Â  Â  Â  Â  { name: "Timestamp", value: new Date().toLocaleString(), inline: true },
Â  Â  Â  Â  Â  Â  { name: "Link", value: "[Go to PokÃ©mon Center](https://www.pokemoncenter.com/)", inline: true }
Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  thumbnail: {
Â  Â  Â  Â  Â  Â  url: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png"
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }]
Â  Â  Â  };

Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(discordWebhookURL, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  });

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  console.log('Discord webhook sent successfully.');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  console.error('Failed to send Discord webhook. Status:', response.status);
Â  Â  Â  Â  Â  const errorText = await response.text();
Â  Â  Â  Â  Â  console.error('Discord Webhook Error Details:', errorText);
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error sending Discord webhook:', error);
Â  Â  Â  }
Â  Â  }
Â  Â  // --- End New Discord Webhook Function ---

Â  Â  function sendEmail(status, details, recipientEmails) {
Â  Â  Â  if (!emailNotificationsEnabled) {
Â  Â  Â  Â  console.log('Email notifications are disabled; skipping email sending.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!recipientEmails || recipientEmails.length === 0) {
Â  Â  Â  Â  console.error('No email addresses provided for sending alerts');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (typeof emailjs === 'undefined') {
Â  Â  Â  Â  console.error('EmailJS is not available');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  recipientEmails.forEach(email => {
Â  Â  Â  Â  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
Â  Â  Â  Â  Â  console.warn(`Invalid email address: ${email}. Skipping.`);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  emailjs.send("service_ahqdaj5", "template_whhvnra", {
Â  Â  Â  Â  Â  status: status,
Â  Â  Â  Â  Â  details: details,
Â  Â  Â  Â  Â  timestamp: new Date().toLocaleString(),
Â  Â  Â  Â  Â  to_email: email
Â  Â  Â  Â  }).then(
Â  Â  Â  Â  Â  () => console.log('Email sent successfully to', email),
Â  Â  Â  Â  Â  (error) => console.error('Failed to send email to', email, ':', error)
Â  Â  Â  Â  );
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // ORIGINAL LOGIC: Deactivate after sending alert
Â  Â  Â  emailNotificationsEnabled = false;
Â  Â  Â  emailToggleButton.textContent = 'Activate Email Alerts';
Â  Â  Â  emailToggleButton.classList.remove('active', 'bg-green-500');
Â  Â  Â  emailToggleButton.classList.add('inactive', 'bg-gray-500');
Â  Â  Â  showEmailFeedback('Email notifications deactivated after sending alert.');
Â  Â  }

Â  Â  // --- New Alert Deactivation Logic ---
Â  Â  function deactivateAlerts() {
Â  Â  Â  // Deactivate Email
Â  Â  Â  emailNotificationsEnabled = false;
Â  Â  Â  emailToggleButton.textContent = 'Activate Email Alerts';
Â  Â  Â  emailToggleButton.classList.remove('active', 'bg-green-500');
Â  Â  Â  emailToggleButton.classList.add('inactive', 'bg-gray-500');
Â  Â  Â  // Deactivate Webhook
Â  Â  Â  webhookNotificationsEnabled = false;
Â  Â  Â  webhookToggleButton.textContent = 'Activate Discord Alerts';
Â  Â  Â  webhookToggleButton.classList.remove('active', 'bg-green-500');
Â  Â  Â  webhookToggleButton.classList.add('inactive', 'bg-gray-500');
Â  Â  Â  showEmailFeedback('All alerts deactivated after sending alert.');
Â  Â  }
Â  Â  // --- End New Alert Deactivation Logic ---

Â  Â  function testEmail() {
Â  Â  Â  const emailInputs = document.querySelectorAll('.email-input');
Â  Â  Â  const recipientEmails = [];
Â  Â  Â  let hasValidEmail = true;
Â  Â  Â  Array.from(emailInputs).forEach((input, index) => {
Â  Â  Â  Â  const email = input.value.trim();
Â  Â  Â  Â  if (email && input.hasAttribute('readonly')) {
Â  Â  Â  Â  Â  if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
Â  Â  Â  Â  Â  Â  recipientEmails.push(email);
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert(`Please ensure email ${index + 1} is valid: ${email}`);
Â  Â  Â  Â  Â  Â  input.focus();
Â  Â  Â  Â  Â  Â  hasValidEmail = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  if (!hasValidEmail) {
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (recipientEmails.length === 0) {
Â  Â  Â  Â  console.warn('No valid email addresses provided.');
Â  Â  Â  Â  alert('No valid email addresses provided.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!emailNotificationsEnabled) {
Â  Â  Â  Â  console.warn('Email notifications are disabled; cannot send test email.');
Â  Â  Â  Â  alert('Email notifications are disabled. Please activate email notifications to send a test email.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (typeof emailjs === 'undefined') {
Â  Â  Â  Â  alert('Email functionality is unavailable. Please check your network connection and try again.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  console.log('Sending test email to:', recipientEmails);
Â  Â  Â  // We temporarily set email notifications to true for the test, then rely on the sendEmail
Â  Â  Â  // to reset it to false or we can just call the original sendEmail and it will reset
Â  Â  Â  // the state.
Â  Â  Â  let originalState = emailNotificationsEnabled;
Â  Â  Â  emailNotificationsEnabled = true;
Â  Â  Â  sendEmail('Test Email', 'This is a test email from PokÃ©mon Center Shop Access Checker.', recipientEmails);
Â  Â  Â  // Restore the original state, since we don't want to disable after a test
Â  Â  Â  emailNotificationsEnabled = originalState;
Â  Â  Â  if(originalState) {
Â  Â  Â  Â  emailToggleButton.textContent = 'Deactivate Email Alerts';
Â  Â  Â  Â  emailToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  Â  emailToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  }
Â  Â  Â  alert('Test email(s) sent! Check your inbox(es) (and spam/junk folder).');
Â  Â  }

Â  Â  // --- New Test Webhook Function ---
Â  Â  function testWebhook() {
Â  Â  Â  if (!discordWebhookURL || !discordWebhookURL.startsWith('https://discord.com/api/webhooks/')) {
Â  Â  Â  Â  alert('Please enter and submit a valid Discord Webhook URL first.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!webhookNotificationsEnabled) {
Â  Â  Â  Â  alert('Discord notifications are disabled. Please activate Discord notifications to send a test webhook.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // We temporarily set webhook notifications to true for the test
Â  Â  Â  let originalState = webhookNotificationsEnabled;
Â  Â  Â  webhookNotificationsEnabled = true;

Â  Â  Â  sendDiscordWebhook('Test Webhook Alert', 'This is a test message from your PokÃ©mon Center Shop Access Checker!').then(() => {
Â  Â  Â  Â  // Restore the original state, since we don't want to disable after a test
Â  Â  Â  Â  webhookNotificationsEnabled = originalState;
Â  Â  Â  Â  if(originalState) {
Â  Â  Â  Â  Â  webhookToggleButton.textContent = 'Deactivate Discord Alerts';
Â  Â  Â  Â  Â  webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
Â  Â  Â  Â  Â  webhookToggleButton.classList.add('active', 'bg-green-500');
Â  Â  Â  Â  }
Â  Â  Â  Â  alert('Test webhook sent! Check your Discord channel.');
Â  Â  Â  });
Â  Â  }
Â  Â  // --- End New Test Webhook Function ---


Â  Â  function extractQueueLength(text) {
Â  Â  Â  const patterns = [
Â  Â  Â  Â  /(\d+)\s*users?\s*ahead/i,
Â  Â  Â  Â  /queue\s*position\s*[:=]?\s*(\d+)/i,
Â  Â  Â  Â  /(\d+)\s*in\s*queue/i,
Â  Â  Â  Â  /position\s*in\s*queue\s*[:=]?\s*(\d+)/i
Â  Â  Â  ];
Â  Â  Â  for (const pattern of patterns) {
Â  Â  Â  Â  const match = text.match(pattern);
Â  Â  Â  Â  if (match) return match[1];
Â  Â  Â  }
Â  Â  Â  return null;
Â  Â  }

Â  Â  async function checkShopAccess() {
Â  Â  Â  const emailInputs = document.querySelectorAll('.email-input');
Â  Â  Â  const currentEmails = [];
Â  Â  Â  Array.from(emailInputs)
Â  Â  Â  Â  .filter(input => input.hasAttribute('readonly'))
Â  Â  Â  Â  .map(input => input.value.trim())
Â  Â  Â  Â  .filter(email => email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
Â  Â  Â  Â  .forEach(email => currentEmails.push(email));
Â  Â  Â  
Â  Â  Â  console.log('Emails for notifications:', currentEmails);
Â  Â  Â  
Â  Â  Â  if (currentEmails.length === 0 && emailNotificationsEnabled) {
Â  Â  Â  Â  console.warn('No valid email addresses provided, disabling email alerts for this run.');
Â  Â  Â  }
Â  Â  Â  if (!discordWebhookURL && webhookNotificationsEnabled) {
Â  Â  Â  Â  console.warn('No Discord Webhook URL provided, disabling webhook alerts for this run.');
Â  Â  Â  }

Â  Â  Â  try {
Â  Â  Â  Â  const proxies = [
Â  Â  Â  Â  Â  'https://corsproxy.io/?',
Â  Â  Â  Â  Â  'https://cors-anywhere.herokuapp.com/',
Â  Â  Â  Â  Â  'https://allorigins.win/raw?url='
Â  Â  Â  Â  ];
Â  Â  Â  Â  const targetUrls = [
Â  Â  Â  Â  Â  'https://www.pokemoncenter.com/',
Â  Â  Â  Â  Â  'https://www.pokemoncenter.com/category/trading-card-game'
Â  Â  Â  Â  ];
Â  Â  Â  Â  
Â  Â  Â  Â  let response = null;
Â  Â  Â  Â  let proxyUsed = '';
Â  Â  Â  Â  let urlUsed = '';
Â  Â  Â  Â  let proxyErrors = [];
Â  Â  Â  Â  
Â  Â  Â  Â  for (const targetUrl of targetUrls) {
Â  Â  Â  Â  Â  for (const proxy of proxies) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  response = await fetch(proxy + encodeURIComponent(targetUrl), {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'GET',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  'Accept': 'text/html',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  proxyUsed = proxy;
Â  Â  Â  Â  Â  Â  Â  urlUsed = targetUrl;
Â  Â  Â  Â  Â  Â  Â  if (response.ok && response.status === 200) break;
Â  Â  Â  Â  Â  Â  Â  proxyErrors.push(`Proxy ${proxy} for ${targetUrl} returned status: ${response?.status || 'unknown'}`);
Â  Â  Â  Â  Â  Â  } catch (proxyError) {
Â  Â  Â  Â  Â  Â  Â  proxyErrors.push(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
Â  Â  Â  Â  Â  Â  Â  console.warn(`Proxy ${proxy} for ${targetUrl} failed:`, proxyError);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (response && response.ok && response.status === 200) break;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  if (response && response.ok && response.status === 200) break;
Â  Â  Â  Â  }

Â  Â  Â  Â  const now = new Date().toLocaleTimeString();
Â  Â  Â  Â  lastChecked.textContent = now;

Â  Â  Â  Â  if (!response || !response.ok) {
Â  Â  Â  Â  Â  const status = 'Proxy error';
Â  Â  Â  Â  Â  const details = `Failed to fetch page through all proxies. Errors: ${proxyErrors.join('; ')}. Please check the site manually.`;
Â  Â  Â  Â  Â  statusText.textContent = status;
Â  Â  Â  Â  Â  statusText.classList.remove('text-green-500');
Â  Â  Â  Â  Â  statusText.classList.add('text-red-500');
Â  Â  Â  Â  Â  statusDetails.textContent = details;
Â  Â  Â  Â  Â  playThreeBeeps();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (statusText.dataset.previousStatus !== status) {
Â  Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(status, details, currentEmails);
Â  Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(status, details);
Â  Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  statusText.dataset.previousStatus = status;
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const finalUrl = decodeURIComponent(response.url.replace(proxyUsed, ''));
Â  Â  Â  Â  const text = await response.text();
Â  Â  Â  Â  const isQueue =
Â  Â  Â  Â  Â  /queue-it\.net/i.test(finalUrl) ||
Â  Â  Â  Â  Â  /waiting room|queue-it|waitingroom|virtual waiting/i.test(text);

Â  Â  Â  Â  if (isQueue) {
Â  Â  Â  Â  Â  const queueLength = extractQueueLength(text);
Â  Â  Â  Â  Â  const currentStatus = 'Shop is active (in queue)';
Â  Â  Â  Â  Â  statusText.textContent = currentStatus;
Â  Â  Â  Â  Â  statusText.classList.remove('text-red-500');
Â  Â  Â  Â  Â  statusText.classList.add('text-green-500');
Â  Â  Â  Â  Â  const details = `Queue detected at ${finalUrl} (checked ${urlUsed}). Queue length: ${queueLength || 'unknown'}. Redirecting to PokÃ©mon Center homepage.`;
Â  Â  Â  Â  Â  statusDetails.textContent = details;
Â  Â  Â  Â  Â  playThreeBeeps();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Notify and stop/redirect
Â  Â  Â  Â  Â  if (statusText.dataset.previousStatus !== currentStatus) {
Â  Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
Â  Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(currentStatus, details);
Â  Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  statusText.dataset.previousStatus = currentStatus;
Â  Â  Â  Â  Â  stopChecking();
Â  Â  Â  Â  Â  window.location.href = 'https://www.pokemoncenter.com/';
Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  } else if (/pokemoncenter\.com(\/|$|\/category\/trading-card-game)/i.test(finalUrl)) {
Â  Â  Â  Â  Â  const hasShopContent = /shop|products|category|store|cart|new releases|all products|add to cart|merchandise|collectibles|plush|trading card|PokÃ©mon/i.test(text);
Â  Â  Â  Â  Â  const hasDynamicElements = /<nav\b|<a\b[^>]*href=["'][^"']*product[^"']*["']|<div\b[^>]*class=["'][^"']*product[^"']*["']/i.test(text);
Â  Â  Â  Â  Â  const isLargeResponse = text.length > 10000;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (hasShopContent || hasDynamicElements || isLargeResponse) {
Â  Â  Â  Â  Â  Â  const currentStatus = 'Shop is accessible!';
Â  Â  Â  Â  Â  Â  statusText.textContent = currentStatus;
Â  Â  Â  Â  Â  Â  statusText.classList.remove('text-red-500');
Â  Â  Â  Â  Â  Â  statusText.classList.add('text-green-500');
Â  Â  Â  Â  Â  Â  statusDetails.textContent = `Reached ${finalUrl} (checked ${urlUsed}), shop content detected (keywords or dynamic elements present). Response length: ${text.length} chars.`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Notify if status changes to accessible
Â  Â  Â  Â  Â  Â  if (statusText.dataset.previousStatus !== currentStatus) {
Â  Â  Â  Â  Â  Â  Â  playThreeBeeps();
Â  Â  Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(currentStatus, statusDetails.textContent, currentEmails);
Â  Â  Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(currentStatus, statusDetails.textContent);
Â  Â  Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  statusText.dataset.previousStatus = currentStatus;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const currentStatus = 'Shop is not accessible (landing page)';
Â  Â  Â  Â  Â  Â  statusText.textContent = currentStatus;
Â  Â  Â  Â  Â  Â  statusText.classList.remove('text-green-500');
Â  Â  Â  Â  Â  Â  statusText.classList.add('text-red-500');
Â  Â  Â  Â  Â  Â  const details = `Reached ${finalUrl} (checked ${urlUsed}), but no shop content or dynamic elements found. Likely a static landing page. Response length: ${text.length} chars.`;
Â  Â  Â  Â  Â  Â  statusDetails.textContent = details;
Â  Â  Â  Â  Â  Â  playThreeBeeps();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (statusText.dataset.previousStatus !== currentStatus) {
Â  Â  Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
Â  Â  Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(currentStatus, details);
Â  Â  Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  statusText.dataset.previousStatus = currentStatus;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  const currentStatus = 'Shop is not accessible (unexpected page)';
Â  Â  Â  Â  Â  statusText.textContent = currentStatus;
Â  Â  Â  Â  Â  statusText.classList.remove('text-green-500');
Â  Â  Â  Â  Â  statusText.classList.add('text-red-500');
Â  Â  Â  Â  Â  const details = `Reached ${finalUrl} (checked ${urlUsed}), but it does not appear to be the PokÃ©mon Center shop. Response length: ${text.length} chars.`;
Â  Â  Â  Â  Â  statusDetails.textContent = details;
Â  Â  Â  Â  Â  playThreeBeeps();

Â  Â  Â  Â  Â  if (statusText.dataset.previousStatus !== currentStatus) {
Â  Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
Â  Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(currentStatus, details);
Â  Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  statusText.dataset.previousStatus = currentStatus;
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error checking page:', error);
Â  Â  Â  Â  const status = 'Site is down';
Â  Â  Â  Â  const details = `Failed to fetch: ${error.message}. Please check the site manually.`;
Â  Â  Â  Â  statusText.textContent = status;
Â  Â  Â  Â  statusText.classList.remove('text-green-500');
Â  Â  Â  Â  statusText.classList.add('text-red-500');
Â  Â  Â  Â  statusDetails.textContent = details;
Â  Â  Â  Â  lastChecked.textContent = new Date().toLocaleTimeString();
Â  Â  Â  Â  playThreeBeeps();

Â  Â  Â  Â  if (statusText.dataset.previousStatus !== status) {
Â  Â  Â  Â  Â  if (emailNotificationsEnabled) sendEmail(status, details, currentEmails);
Â  Â  Â  Â  Â  if (webhookNotificationsEnabled) sendDiscordWebhook(status, details);
Â  Â  Â  Â  Â  deactivateAlerts(); // Deactivate both after sending
Â  Â  Â  Â  }
Â  Â  Â  Â  statusText.dataset.previousStatus = status;
Â  Â  Â  }
Â  Â  }

Â  Â  function startChecking() {
Â  Â  Â  const emailInputs = document.querySelectorAll('.email-input');
Â  Â  Â  let allEmailsValid = true;
Â  Â  Â  let hasAtLeastOneEmail = false;
Â  Â  Â  
Â  Â  Â  // Check Webhook submission
Â  Â  Â  if (discordWebhookURL && !discordWebhookInput.hasAttribute('readonly')) {
Â  Â  Â  Â  alert('Please submit the Discord Webhook URL before starting.');
Â  Â  Â  Â  discordWebhookInput.focus();
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Check Emails
Â  Â  Â  Array.from(emailInputs).forEach((input, index) => {
Â  Â  Â  Â  const email = input.value.trim();
Â  Â  Â  Â  if (email && !input.hasAttribute('readonly')) {
Â  Â  Â  Â  Â  alert('Please submit all email addresses before starting.');
Â  Â  Â  Â  Â  input.focus();
Â  Â  Â  Â  Â  allEmailsValid = false;
Â  Â  Â  Â  } else if (email && input.hasAttribute('readonly')) {
Â  Â  Â  Â  Â  if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
Â  Â  Â  Â  Â  Â  hasAtLeastOneEmail = true;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert(`Please ensure email ${index + 1} is valid: ${email}`);
Â  Â  Â  Â  Â  Â  input.focus();
Â  Â  Â  Â  Â  Â  allEmailsValid = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  if (!allEmailsValid) {
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!hasAtLeastOneEmail && !discordWebhookURL) {
Â  Â  Â  Â  console.warn('No valid email or webhook provided.');
Â  Â  Â  Â  alert('Please submit at least one valid email address OR a Discord Webhook URL.');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  if (intervalId) {
Â  Â  Â  Â  clearTimeout(intervalId);
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  function scheduleNextCheck() {
Â  Â  Â  Â  currentCheckInterval = parseInt(frequencySlider.value) * 60 * 1000;
Â  Â  Â  Â  const randomizedInterval = getRandomInterval(currentCheckInterval);
Â  Â  Â  Â  console.log(`Next check in ${randomizedInterval / 1000 / 60} minutes`);
Â  Â  Â  Â  intervalId = setTimeout(() => {
Â  Â  Â  Â  Â  checkShopAccess();
Â  Â  Â  Â  Â  scheduleNextCheck();
Â  Â  Â  Â  }, randomizedInterval);
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  checkShopAccess();
Â  Â  Â  scheduleNextCheck();
Â  Â  Â  
Â  Â  Â  startButton.classList.add('hidden');
Â  Â  Â  stopButton.classList.remove('hidden');
Â  Â  Â  statusText.textContent = 'Checking...';
Â  Â  Â  statusDetails.textContent = 'Started checking with randomized intervals.';
Â  Â  Â  startTimer();
Â  Â  }

Â  Â  function stopChecking() {
Â  Â  Â  if (intervalId) {
Â  Â  Â  Â  clearTimeout(intervalId);
Â  Â  Â  Â  intervalId = null;
Â  Â  Â  Â  startButton.classList.remove('hidden');
Â  Â  Â  Â  stopButton.classList.add('hidden');
Â  Â  Â  Â  statusText.textContent = 'Stopped.';
Â  Â  Â  Â  statusDetails.textContent = 'Checking stopped.';
Â  Â  Â  Â  stopTimer();
Â  Â  Â  }
Â  Â  }

Â  Â  startButton.addEventListener('click', startChecking);
Â  Â  stopButton.addEventListener('click', stopChecking);
Â  Â  testEmailButton.addEventListener('click', testEmail);
Â  Â  testWebhookButton.addEventListener('click', testWebhook);
Â  </script>
</body>
</html>
