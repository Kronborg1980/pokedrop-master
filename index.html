<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queue Hunter ‚Äì Pok√©mon Center Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
<style>
/* --- Queue Hunter Ultra Styles --- */
body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(135deg,#1e1e2f,#0d0d15);
  color: #fff;
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow-x: hidden;
}
.pokedex {
  background: linear-gradient(145deg, rgba(30,30,50,0.9), rgba(0,0,20,0.9));
  border: 4px solid #FFD700;
  border-radius: 20px;
  padding: 2rem;
  width: 100%;
  max-width: 440px;
  box-shadow: 0 25px 50px rgba(0,0,0,0.5), inset 0 0 15px rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  position: relative;
  z-index: 10;
}
.header{
  text-align:center;
  margin-bottom:1.5rem;
}
.header img{
  width:120px;
  filter:drop-shadow(0 0 15px #FFD700);
  margin-bottom:0.5rem;
}
.header h1{
  font-family:'Orbitron',sans-serif;
  color:#FFD700;
  font-size:1.5rem;
  text-shadow:2px 2px 4px #000;
  margin:0;
}
.header p{
  color:#fff;
  font-size:0.9rem;
  text-shadow:1px 1px 2px #000;
  margin:0.5rem 0 0;
}
.section{
  margin-bottom:1.2rem;
  padding:1rem;
  background:rgba(255,255,255,0.05);
  border-radius:12px;
  border:2px solid #FFD700;
  backdrop-filter:blur(5px);
}
.section label{
  display:block;
  font-family:'Orbitron',sans-serif;
  font-size:0.8rem;
  color:#fff;
  margin-bottom:0.5rem;
}
input, select{
  border:2px solid #FFD700;
  border-radius:10px;
  padding:0.6rem;
  width:100%;
  box-sizing:border-box;
  font-size:0.8rem;
  background:rgba(255,255,255,0.1);
  color:#fff;
  font-family:'Roboto',sans-serif;
  transition:all 0.3s;
}
input:focus, select:focus{
  border-color:#FFB300;
  box-shadow:0 0 10px #FFD700;
}
.button-group{display:flex;gap:0.6rem;flex-wrap:wrap;justify-content:center;}
button{
  background:linear-gradient(145deg,#FFD700,#FFB300);
  color:#1A1A1A;
  border:2px solid #1A1A1A;
  padding:0.8rem 1.5rem;
  border-radius:25px;
  font-family:'Orbitron',sans-serif;
  font-size:0.8rem;
  cursor:pointer;
  transition:all 0.3s;
  box-shadow:0 5px 15px rgba(0,0,0,0.3);
  position:relative;
  overflow:hidden;
}
button:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.4);}
button:disabled{background:#666;color:#999;transform:none;cursor:not-allowed;}
.status-pokedex{
  background:linear-gradient(145deg,#3F51B5,#1A237E);
  color:#FFF;
  padding:1.2rem;
  border-radius:12px;
  margin-top:1.2rem;
  text-shadow:1px 1px 2px #000;
  text-align:left;
  border:2px solid #FFD700;
  backdrop-filter:blur(5px);
  max-height:300px;
  overflow-y:auto;
}
.status-pokedex p{margin:0.4rem 0;font-size:0.8rem;}
.status-pokedex .status-text{font-family:'Orbitron',sans-serif;font-size:1rem;font-weight:bold;}
.log-container{
  max-height:140px;
  overflow-y:auto;
  font-size:0.7rem;
  text-align:left;
  background:rgba(255,255,255,0.05);
  padding:0.6rem;
  border-radius:10px;
  margin-top:0.6rem;
  border:1px solid #FFD700;
  color:#FFF;
  font-family:'Roboto',sans-serif;
}
.alert-zap{animation:zap 0.3s ease infinite;}
@keyframes zap{
  0%,100%{border-color:#FFD700;box-shadow:0 0 25px #FFD700;}
  50%{border-color:#FFB300;box-shadow:0 0 35px #FFB300;}
}
.hidden{display:none;}
@media(max-width:480px){
  .pokedex{padding:1.2rem;margin:0.6rem;max-width:340px;}
  .header h1{font-size:1.2rem;}
  .header img{width:100px;}
  .button-group{flex-direction:column;}
  button{padding:0.7rem 1.2rem;font-size:0.7rem;}
}
</style>
</head>
<body>
<div class="pokedex">
  <div class="header">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png" alt="Magikarp">
    <h1>Queue Hunter</h1>
    <p>Magikarp & Cubone tracking queues like a boss! ‚ö°</p>
  </div>

  <div class="section">
    <label>Discord Webhook URL:</label>
    <input type="url" id="discordWebhook" placeholder="https://discord.com/api/webhooks/...">
    <div class="button-group">
      <button onclick="testDiscord()">üì¨ Test Discord</button>
    </div>
  </div>

  <div class="section">
    <label>Queue Alert Sound / Vibration:</label>
    <div class="button-group">
      <button id="alarmBtn" onclick="toggleAlarm()">‚ö° Activate Alarm</button>
      <button onclick="testAlarm()">üîä Test Alarm</button>
    </div>
  </div>

  <div class="section">
    <label>Check Frequency: <span id="freqVal">5</span> mins</label>
    <input type="range" id="freqSlider" min="1" max="30" value="5">
    <label>Alert After: <span id="threshVal">2</span> fails</label>
    <input type="range" id="threshSlider" min="1" max="5" value="2">
    <label>Specific URL (optional):</label>
    <input type="url" id="specificUrl" placeholder="https://www.pokemoncenter.com/product/...">
  </div>

  <div class="section">
    <div class="button-group">
      <button id="startBtn" onclick="startMonitoring()">üîé Start Queue Hunt</button>
      <button id="stopBtn" class="hidden" onclick="stopMonitoring()">‚èπÔ∏è Stop Hunt</button>
    </div>
  </div>

  <div class="status-pokedex" id="status-pokedex">
    <p><strong>Status:</strong> <span class="status-text" id="statusText">Ready to hunt!</span></p>
    <p>Last Check: <span id="lastCheck">Never</span></p>
    <p>Runtime: <span id="runtime">0m 0s</span></p>
    <p>Consecutive Fails: <span id="consec">0</span></p>
    <p>Log / Details:</p>
    <div class="log-container" id="details"></div>
  </div>
</div>

<audio id="alertTone" preload="auto" loop>
  <source src="https://cdn.freesound.org/previews/316/316847_4939433-lq.mp3" type="audio/mpeg">
</audio>

<script>
// --- State & Settings ---
let intervalId = null, startTime = null, consecFails = 0, failThresh = 2, checkFreq = 5*60*1000;
let proxies = ['https://corsproxy.io/?','https://api.allorigins.win/get?url=','https://thingproxy.freeboard.io/fetch/','https://cors-anywhere.herokuapp.com/','https://api.codetabs.com/v1/proxy?quest='];
let blacklisted = new Set(), webhookUrl = '', logEntries = [], retryCount = 0, maxRetries = 3, alarmActive=false, alertAudio=null;

// --- UI Update ---
function updateUI(status, logMessage){
  document.getElementById('statusText').textContent=status;
  document.getElementById('lastCheck').textContent=new Date().toLocaleTimeString();
  document.getElementById('consec').textContent=consecFails;
  logEntries.unshift(`[${new Date().toLocaleTimeString()}] ${logMessage}`);
  if(logEntries.length>15) logEntries.pop();
  const logEl=document.getElementById('details');
  logEl.innerHTML=logEntries.join('<br>');
  logEl.scrollTop = 0; // scroll to top latest log
  const sp=document.getElementById('status-pokedex');
  if(/queue/i.test(status)) sp.classList.add('alert-zap'); else sp.classList.remove('alert-zap');
  updateRuntime();
}
function updateRuntime(){
  if(startTime) document.getElementById('runtime').textContent=`${Math.floor((Date.now()-startTime)/60000)}m ${Math.floor(((Date.now()-startTime)%60000)/1000)}s`;
}
setInterval(updateRuntime,1000);

// --- Alarm & Vibration ---
function toggleAlarm(){
  alarmActive=!alarmActive;stopAlert();
  document.getElementById('alarmBtn').textContent=alarmActive?'‚ö° Deactivate Alarm':'‚ö° Activate Alarm';
  updateUI('Ready to hunt!',`Alarm ${alarmActive?'activated':'deactivated'}`);
}
function testAlarm(){
  try{
    const a=document.getElementById('alertTone');
    a.play().then(()=>setTimeout(()=>{a.pause();a.currentTime=0;},5000));
    if(navigator.vibrate) navigator.vibrate([200,100,200]);
    updateUI('Ready to hunt!','Tested alert tone and vibration for 5 seconds');
  }catch(e){updateUI('Ready to hunt!',`Test alarm error: ${e.message}`);}
}
function playAlert(){
  if(alarmActive&&!alertAudio){
    alertAudio=document.getElementById('alertTone');
    alertAudio.play().catch(()=>{});
    if(navigator.vibrate) navigator.vibrate([300,200,300]);
    updateUI('Queue Detected üö®','Alert tone & vibration activated!');
  }
}
function stopAlert(){
  if(alertAudio){alertAudio.pause();alertAudio.currentTime=0;alertAudio=null;}
}

// --- Discord ---
async function sendDiscord(title,desc,color=0xFFD700){
  webhookUrl=document.getElementById('discordWebhook')?.value||'';
  if(!webhookUrl){updateUI('Ready to hunt!','Discord skipped: No webhook');return;}
  const embed={title,description:desc,color,footer:{text:"Queue Hunter"}};
  try{await fetch(webhookUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[embed]})});
  updateUI('Ready to hunt!',`Sent Discord: ${title}`);}catch(e){updateUI('Ready to hunt!',`Discord error: ${e.message}`);}
}
async function testDiscord(){await sendDiscord('üì¨ Test Ping','Webhook online! Ready to catch queue alerts! ‚ö°');}

// --- Proxy ---
async function getHealthyProxy(url){
  for(let p of proxies.filter(pr=>!blacklisted.has(pr))){
    updateUI('Checking proxies...',`Trying proxy: ${p}`);
    try{
      const ctrl=new AbortController();setTimeout(()=>ctrl.abort(),8000);
      const res=await fetch(`${p}${encodeURIComponent(url)}`,{signal:ctrl.signal});
      if(res.ok){updateUI('Proxy OK',`Using proxy: ${p}`);return p;}
    }catch(e){
      blacklisted.add(p);setTimeout(()=>blacklisted.delete(p),300000);
      updateUI('Proxy failed',`Proxy ${p} error: ${e.message}`);
    }
  }
  return null;
}

// --- Queue Detection ---
function extractQueue(text,url,headers){
  const posMatch=text.match(/pos["']?\s*[:=]\s*["']?(\d+)/i)||url.match(/pos=(\d+)/i);
  const queueItScript=/queueit\.js/i.test(text);
  const queueItHeader=headers.get('x-queueit')||headers.get('x-queueit-redirect');
  const queueItUrl=/queue-it\.net/i.test(url);
  const waitingRoom=/waiting room|queueit/i.test(text);
  if(posMatch) return posMatch[1];
  if(queueItScript||queueItHeader||queueItUrl||waitingRoom) return 'Unknown';
  return null;
}

// --- Check Site ---
async function checkSite(isConsec=false){
  const specific=document.getElementById('specificUrl')?.value||'';
  const urls=specific?[specific]:['https://www.pokemoncenter.com/','https://www.pokemoncenter.com/category/new-releases','https://www.pokemoncenter.com/category/trading-card-game'];
  let success=false,queuePos=null,details='';
  updateUI('Checking... üïµÔ∏è',`Investigating ${specific||'Pok√©mon Center'}...`);
  for(let url of urls){
    updateUI('Checking URL...',`Sleuthing URL: ${url}`);
    const proxy=await getHealthyProxy(url);
    if(!proxy){details='Investigation failed: No healthy proxies.';consecFails++;updateUI('Fail',details);continue;}
    try{
      const ctrl=new AbortController();setTimeout(()=>ctrl.abort(),8000);
      const res=await fetch(`${proxy}${encodeURIComponent(url)}`,{signal:ctrl.signal});
      if(res.ok){
        const text=proxy.includes('allorigins')?(await res.json()).contents:await res.text();
        const finalUrl=decodeURIComponent(res.url.replace(proxy,''));
        queuePos=extractQueue(text,finalUrl,res.headers);
        if(queuePos){
          details=`Queue detected! Position: ${queuePos}`;
          playAlert();
          updateUI('Queue Detected üö®',details);
          sendDiscord('üö® Queue Alert!',details);
          return {success:false,queuePos,isFail:true};
        }else{
          details=`No queue detected. Proxy: ${proxy}, URL: ${finalUrl}, Analysis: No pos found, no queue headers, scripts or waiting room indicators.`;
          success=true;consecFails=0;stopAlert();updateUI('Hunting... üïµÔ∏è',details);
          break;
        }
      }else{
        details=`HTTP error: ${res.status} at ${url}`;consecFails++;updateUI('Fail',details);
      }
    }catch(e){details=`Error on ${url}: ${e.message}`;consecFails++;updateUI('Fail',details);}
  }
  return {success,queuePos,isFail:!success};
}

// --- Consecutive Verification ---
async function verifyConsec(count=1){
  if(count>=failThresh){
    updateUI('Verifying...',`Confirming failure ${count} of ${failThresh}...`);
    const result=await checkSite(true);
    if(!result.isFail){consecFails=0;stopAlert();}
    else{await new Promise(r=>setTimeout(r,5000));await verifyConsec(count+1);}
  }
}

// --- Start / Stop ---
async function startMonitoring(){
  consecFails=0;retryCount=0;startTime=Date.now();logEntries=[];stopAlert();
  await checkSite();
  intervalId=setInterval(async()=>{
    const result=await checkSite();
    if(result.isFail) consecFails++;
    if(consecFails>=failThresh) await verifyConsec();
  },checkFreq+Math.random()*60000-30000);
  document.getElementById('startBtn')?.classList.add('hidden');
  document.getElementById('stopBtn')?.classList.remove('hidden');
  updateUI('Checking... üïµÔ∏è','Started queue investigation');
}
function stopMonitoring(){
  clearInterval(intervalId);intervalId=null;startTime=null;consecFails=0;retryCount=0;stopAlert();
  document.getElementById('startBtn')?.classList.remove('hidden');
  document.getElementById('stopBtn')?.classList.add('hidden');
  updateUI('Hunt Paused üõë','Investigation stopped');
}

// --- Sliders ---
document.getElementById('freqSlider')?.addEventListener('input',e=>{
  checkFreq=e.target.value*60*1000;
  document.getElementById('freqVal').textContent=e.target.value;
  updateUI('Ready to hunt!',`Check frequency set to ${e.target.value} mins`);
});
document.getElementById('threshSlider')?.addEventListener('input',e=>{
  failThresh=e.target.value;
  document.getElementById('threshVal').textContent=e.target.value;
  updateUI('Ready to hunt!',`Alert threshold set to ${e.target.value} fails`);
});
</script>
</body>
</html>
