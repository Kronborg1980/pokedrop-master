<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pok√©mon Center Shop Access Checker</title>
  <style>
    /* Tailwind-like utility classes */
    .bg-gray-100 { background-color: #f3f4f6; }
    .bg-white { background-color: #ffffff; }
    .bg-blue-500 { background-color: #3b82f6; }
    .bg-red-500 { background-color: #ef4444; }
    .bg-green-500 { background-color: #10b981; }
    .bg-purple-500 { background-color: #8b5cf6; }
    .bg-gray-500 { background-color: #6b7280; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-500 { color: #6b7280; }
    .text-red-500 { color: #ef4444; }
    .text-green-500 { color: #22c55e; }
    .text-purple-500 { color: #8b5cf6; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .p-6 { padding: 1.5rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .w-full { width: 100%; }
    .max-w-md { max-width: 28rem; }
    .rounded { border-radius: 0.25rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    .border { border-width: 1px; }
    .border-gray-300 { border-color: #d1d5db; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .min-h-screen { min-height: 100vh; }
    .text-center { text-align: center; }
    .hidden { display: none; }
    .hover\:bg-blue-600:hover { background-color: #2563eb; }
    .hover\:bg-red-600:hover { background-color: #dc2626; }
    .hover\:bg-green-600:hover { background-color: #059669; }
    .hover\:bg-purple-600:hover { background-color: #7c3aed; }
    .hover\:bg-gray-600:hover { background-color: #4b5563; }
    /* Professional Tron-like Theme */
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(to bottom, #0a0a0a, #1a1a2e, #16213e, #0f3460);
      color: #ffffff;
      position: relative;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #00ffff #1a1a2e;
    }
    body::-webkit-scrollbar {
      width: 8px;
    }
    body::-webkit-scrollbar-track {
      background: #1a1a2e;
    }
    body::-webkit-scrollbar-thumb {
      background: #00ffff;
      border-radius: 4px;
    }
    body::-webkit-scrollbar-thumb:hover {
      background: #00cccc;
    }
    .main-container {
      background: rgba(10, 10, 10, 0.9);
      border: 2px solid #00ffff;
      box-shadow: 0 0 20px #00ffff, inset 0 0 20px rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      padding: 2rem;
      max-width: 32rem;
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid #00ffff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    .header h1 {
      font-size: 1.25rem;
      font-weight: bold;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
      margin: 0;
      flex: 1;
      text-align: center;
    }
    .pokemon-header-sprite {
      width: 72px; /* 20% larger than original 60px */
      height: auto;
      filter: drop-shadow(0 0 10px #00ffff);
      z-index: 5;
    }
    .magikarp-header {
      animation: bob 2s infinite ease-in-out;
    }
    .cubone-header {
      animation: hop 3s infinite ease-in-out;
    }
    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes hop {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
    }
    .section {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(26, 26, 46, 0.5);
      border: 1px solid #00ffff;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
    }
    .section label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: #00ffff;
      margin-bottom: 0.5rem;
    }
    input[type="email"], input[type="range"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #00ffff;
      border-radius: 4px;
      background: rgba(10, 10, 10, 0.8);
      color: #ffffff;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
      transition: box-shadow 0.3s ease;
    }
    input[type="email"]:focus {
      outline: none;
      box-shadow: 0 0 10px #00ffff;
    }
    input[type="range"] {
      height: 6px;
      background: rgba(0, 255, 255, 0.2);
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      background: #00ffff;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px #00ffff;
    }
    button {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 4px;
      background: linear-gradient(45deg, #00ffff, #0080ff);
      color: #000;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      transition: all 0.3s ease;
      white-space: normal;
      text-align: center;
    }
    button:hover {
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
      transform: translateY(-2px);
    }
    button.active {
      background: linear-gradient(45deg, #10b981, #059669);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }
    button.inactive {
      background: #6b7280;
      box-shadow: 0 0 10px rgba(107, 114, 128, 0.5);
    }
    .email-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .email-input-group input {
      flex: 1;
    }
    .email-input-group button {
      flex-shrink: 0;
      width: auto;
      padding: 0.5rem 1rem;
    }
    .submitted-emails {
      margin-top: 0.5rem;
      padding: 1rem;
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid #00ffff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    .submitted-emails-header {
      font-size: 0.875rem;
      font-weight: 600;
      color: #00ffff;
      text-shadow: 0 0 5px #00ffff;
      margin-bottom: 0.75rem;
      text-align: left;
    }
    .submitted-emails li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      margin-bottom: 0.5rem;
      background: rgba(26, 26, 46, 0.7);
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
      font-size: 0.9rem; /* Increased font size for better visibility */
      color: #ffffff;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      animation: fadeIn 0.3s ease-in;
    }
    .submitted-emails li:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .submitted-emails li span {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .submitted-emails button {
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      border-radius: 4px;
      background: linear-gradient(45deg, #ef4444, #dc2626);
      box-shadow: 0 0 5px rgba(239, 68, 68, 0.5);
      transition: all 0.3s ease;
    }
    .submitted-emails button:hover {
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
      transform: translateY(-1px);
    }
    .no-emails-message {
      font-size: 0.875rem;
      color: #00ffff;
      text-align: center;
      padding: 0.5rem;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 4px;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .checkbox-group input[type="checkbox"] {
      width: auto;
      accent-color: #00ffff;
    }
    .status-display {
      background: rgba(26, 26, 46, 0.5);
      border: 1px solid #00ffff;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
    }
    .status-display p {
      margin: 0.25rem 0;
      font-size: 0.875rem;
    }
    .live-log {
      flex: 1;
      overflow-y: auto;
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid #00ffff;
      border-radius: 8px;
      padding: 1rem;
      margin-top: auto;
      font-size: 0.75rem;
      font-family: 'Courier New', monospace;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
      min-height: 150px;
    }
    .live-log p {
      margin: 0.25rem 0;
      word-wrap: break-word;
      color: #ffffff;
    }
    .status-feedback {
      color: #00ff00;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .status-feedback.show {
      opacity: 1;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .button-group button {
      flex: 1;
      min-width: 120px;
    }
    @media (max-height: 600px) {
      .main-container {
        min-height: 90vh;
        padding: 1rem;
      }
      .live-log {
        min-height: 100px;
      }
    }
    /* Success explosion animation */
    .success-explosion {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
    }
    .success-explosion.show {
      opacity: 1;
      animation: explode 1s ease-out forwards;
    }
    @keyframes explode {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 0; }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="main-container">
    <div class="header">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png" alt="Magikarp" class="pokemon-header-sprite magikarp-header">
      <h1>Pok√©mon Center Shop Access Checker<br>Made By Kronborg</h1>
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png" alt="Cubone" class="pokemon-header-sprite cubone-header">
    </div>
    <div class="section">
      <label>Emails for alerts:</label>
      <div id="emailInputsContainer">
        <div class="email-input-group">
          <input type="email" placeholder="name@example.com" class="email-input" required>
          <button type="button" class="submit-email-button bg-green-500 text-white">Submit Email</button>
        </div>
      </div>
      <div class="submitted-emails">
        <div class="submitted-emails-header">Submitted Emails</div>
        <ul id="submittedEmailsList"></ul>
      </div>
      <button id="addEmailButton" class="add-email-button mt-2 bg-green-500 text-white">Add Another Email</button>
      <div id="emailFeedback" class="status-feedback"></div>
    </div>
    <div class="section">
      <label>Discord Alerts:</label>
      <button id="addWebhookButton" class="add-webhook-button bg-purple-500 text-white">Add Discord Webhook</button>
      <div id="webhookStatus" class="text-sm mt-1 hidden text-green-500">Webhook added! Ready for alerts.</div>
      <div id="webhookFeedback" class="status-feedback"></div>
    </div>
    <div class="section">
      <label>Check every: <span id="frequencyValue" class="font-semibold">10</span> minutes</label>
      <input type="range" id="frequencySlider" min="1" max="60" value="10">
    </div>
    <div class="section">
      <label>Auto-redirect on queue?</label>
      <div class="checkbox-group">
        <input type="checkbox" id="autoRedirect" checked>
        <label for="autoRedirect" class="text-sm">Yes, redirect to Pok√©mon Center if queue detected</label>
      </div>
    </div>
    <div class="button-group">
      <button id="testButton" class="test-button bg-yellow-500 text-black">Test Single Check</button>
      <button id="startButton" class="bg-blue-500 text-white">Start Checking</button>
      <button id="stopButton" class="bg-red-500 text-white hidden">Stop Checking</button>
      <button id="emailToggleButton" class="email-toggle-button active bg-green-500 text-white">Deactivate Email Alerts</button>
      <button id="webhookToggleButton" class="webhook-toggle-button inactive bg-gray-500 text-white hidden">Activate Discord Alerts</button>
      <button id="testEmailButton" class="bg-green-500 text-white">Test Email</button>
      <button id="testDiscordButton" class="bg-purple-500 text-white">Test Discord</button>
      <button id="testAlertsButton" class="bg-green-500 text-white">Test All Alerts</button>
    </div>
    <div class="status-display">
      <p><strong>Status:</strong> <span id="statusText">Waiting...</span></p>
      <p><strong>Last checked:</strong> <span id="lastChecked">Never</span></p>
      <p><strong>Running for:</strong> <span id="runTime">0h 0m 0s</span></p>
      <p><strong>Details:</strong> <span id="statusDetails">None</span></p>
    </div>
    <div id="liveLog" class="live-log">
      <p>[Startup] Pok√©mon Center Shop Access Checker initialized! üöÄ</p>
    </div>
  </div>
  <div id="successExplosion" class="success-explosion hidden"></div>
  <audio id="beepSound">
    <source src="https://www.soundjay.com/buttons/beep-01a.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
  <script>
    if (typeof emailjs === 'undefined') {
      console.error('EmailJS failed to load. Please check the CDN URL or network connection.');
      alert('Email functionality is unavailable. Please check your network connection and try again.');
    } else {
      emailjs.init({
        publicKey: "8w7eu6mrg3lRl6ta3"
      });
    }
    const statusText = document.getElementById('statusText');
    const lastChecked = document.getElementById('lastChecked');
    const statusDetails = document.getElementById('statusDetails');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const testButton = document.getElementById('testButton');
    const testEmailButton = document.getElementById('testEmailButton');
    const testDiscordButton = document.getElementById('testDiscordButton');
    const testAlertsButton = document.getElementById('testAlertsButton');
    const emailToggleButton = document.getElementById('emailToggleButton');
    const webhookToggleButton = document.getElementById('webhookToggleButton');
    const webhookStatus = document.getElementById('webhookStatus');
    const addWebhookButton = document.getElementById('addWebhookButton');
    const beepSound = document.getElementById('beepSound');
    const runTime = document.getElementById('runTime');
    const emailInputsContainer = document.getElementById('emailInputsContainer');
    const addEmailButton = document.getElementById('addEmailButton');
    const submittedEmailsList = document.getElementById('submittedEmailsList');
    const emailFeedback = document.getElementById('emailFeedback');
    const webhookFeedback = document.getElementById('webhookFeedback');
    const frequencySlider = document.getElementById('frequencySlider');
    const frequencyValue = document.getElementById('frequencyValue');
    const liveLog = document.getElementById('liveLog');
    const autoRedirectCheckbox = document.getElementById('autoRedirect');
    let intervalId = null;
    let startTime = null;
    let timerInterval = null;
    let currentCheckInterval = 10 * 60 * 1000;
    let emailNotificationsEnabled = true;
    let discordNotificationsEnabled = false;
    let discordWebhook = null;
    const CAPSOLVER_API_KEY = 'CAP-E20E90A1238FE858B9CCCFC6F53DC436C385BF7089101FD86F5EEA47FC43CA95';
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('p');
      logEntry.textContent = `[${timestamp}] ${message}`;
      liveLog.appendChild(logEntry);
      liveLog.scrollTop = liveLog.scrollHeight;
      console.log(message);
    }
    log('System initialized - Ready for Pok√©mon Center monitoring!');
    emailToggleButton.addEventListener('click', () => {
      emailNotificationsEnabled = !emailNotificationsEnabled;
      if (emailNotificationsEnabled) {
        emailToggleButton.textContent = 'Deactivate Email Alerts';
        emailToggleButton.classList.remove('inactive');
        emailToggleButton.classList.add('active');
      } else {
        emailToggleButton.textContent = 'Activate Email Alerts';
        emailToggleButton.classList.remove('active');
        emailToggleButton.classList.add('inactive');
      }
      showFeedback(emailFeedback, `Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
      log(`Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
    });
    addWebhookButton.addEventListener('click', () => {
      discordWebhook = 'https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN';
      addWebhookButton.classList.add('hidden');
      webhookStatus.classList.remove('hidden');
      webhookToggleButton.classList.remove('hidden');
      discordNotificationsEnabled = true;
      webhookToggleButton.textContent = 'Deactivate Discord Alerts';
      webhookToggleButton.classList.remove('inactive');
      webhookToggleButton.classList.add('active');
      showFeedback(webhookFeedback, 'Discord webhook added!');
      log('Discord webhook added successfully! Alerts ready.');
    });
    webhookToggleButton.addEventListener('click', () => {
      discordNotificationsEnabled = !discordNotificationsEnabled;
      if (discordNotificationsEnabled) {
        webhookToggleButton.textContent = 'Deactivate Discord Alerts';
        webhookToggleButton.classList.remove('inactive');
        webhookToggleButton.classList.add('active');
      } else {
        webhookToggleButton.textContent = 'Activate Discord Alerts';
        webhookToggleButton.classList.remove('active');
        webhookToggleButton.classList.add('inactive');
      }
      showFeedback(webhookFeedback, `Discord notifications ${discordNotificationsEnabled ? 'enabled' : 'disabled'}.`);
      log(`Discord notifications ${discordNotificationsEnabled ? 'enabled' : 'disabled'}.`);
    });
    function getRandomInterval(baseInterval) {
      const variation = Math.floor(Math.random() * (120000 - 60000 + 1)) + 60000;
      const randomSign = Math.random() < 0.5 ? -1 : 1;
      return baseInterval + (randomSign * variation);
    }
    frequencySlider.addEventListener('input', function() {
      frequencyValue.textContent = this.value;
      if (intervalId) {
        stopChecking();
        startChecking();
      }
    });
    function showFeedback(feedbackElement, message) {
      feedbackElement.textContent = message;
      feedbackElement.classList.add('show');
      setTimeout(() => {
        feedbackElement.classList.remove('show');
      }, 2000);
    }
    function addEmailInputField() {
      const emailInputGroup = document.createElement('div');
      emailInputGroup.className = 'email-input-group';
      emailInputGroup.innerHTML = `
        <input type="email" placeholder="name@example.com" class="email-input" required>
        <button type="button" class="submit-email-button bg-green-500 text-white">Submit Email</button>
      `;
      emailInputsContainer.appendChild(emailInputGroup);
      const submitButton = emailInputGroup.querySelector('.submit-email-button');
      const emailInput = emailInputGroup.querySelector('.email-input');
      submitButton.addEventListener('click', function() {
        const email = emailInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          emailInput.focus();
          return;
        }
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${email}</span>
          <button type="button" class="remove-email-button bg-red-500 text-white">Remove</button>
        `;
        submittedEmailsList.appendChild(li);
        emailInput.value = '';
        showFeedback(emailFeedback, 'Email submitted.');
        log(`Email submitted: ${email}`);
        const removeButton = li.querySelector('.remove-email-button');
        removeButton.addEventListener('click', function() {
          li.remove();
          showFeedback(emailFeedback, 'Email removed.');
          log(`Email removed: ${email}`);
        });
      });
      log('New email input field added.');
      showFeedback(emailFeedback, 'Email field added.');
    }
    document.addEventListener('DOMContentLoaded', () => {
      const initialInputGroup = emailInputsContainer.querySelector('.email-input-group');
      const initialInput = initialInputGroup.querySelector('.email-input');
      const submitButton = initialInputGroup.querySelector('.submit-email-button');
      submitButton.addEventListener('click', function() {
        const email = initialInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          initialInput.focus();
          return;
        }
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${email}</span>
          <button type="button" class="remove-email-button bg-red-500 text-white">Remove</button>
        `;
        submittedEmailsList.appendChild(li);
        initialInput.value = '';
        showFeedback(emailFeedback, 'Email submitted.');
        log(`Email submitted: ${email}`);
        const removeButton = li.querySelector('.remove-email-button');
        removeButton.addEventListener('click', function() {
          li.remove();
          showFeedback(emailFeedback, 'Email removed.');
          log(`Email removed: ${email}`);
        });
      });
    });
    addEmailButton.addEventListener('click', addEmailInputField);
    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${hours}h ${minutes}m ${secs}s`;
    }
    function updateRunTime() {
      if (startTime) {
        const now = Date.now();
        runTime.textContent = formatDuration(now - startTime);
      }
    }
    function startTimer() {
      if (!startTime) {
        startTime = Date.now();
        timerInterval = setInterval(updateRunTime, 2000);
      }
    }
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      startTime = null;
      runTime.textContent = '0h 0m 0s';
    }
    function playThreeBeeps() {
      let beepCount = 0;
      const beepInterval = setInterval(() => {
        if (beepCount < 3) {
          beepSound.currentTime = 0;
          beepSound.play().catch(() => log('Audio playback failed'));
          beepCount++;
        } else {
          clearInterval(beepInterval);
          beepSound.pause();
          beepSound.currentTime = 0;
        }
      }, 1500);
    }
    async function solveCaptchaWithCapSolver(text, urlUsed) {
      log('CAPTCHA detected, attempting to solve with CapSolver...');
      const sitekeyMatch = text.match(/data-sitekey=["']([^"']+)["']/);
      if (!sitekeyMatch) {
        log('No sitekey found in HTML.');
        return null;
      }
      const sitekey = sitekeyMatch[1];
      log(`Sitekey extracted: ${sitekey}`);
      const task = {
        type: 'ReCaptchaV2TaskProxyless',
        websiteURL: urlUsed,
        websiteKey: sitekey
      };
      try {
        const createResponse = await fetch('https://api.capsolver.com/createTask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            clientKey: CAPSOLVER_API_KEY,
            task: task
          })
        });
        const createData = await createResponse.json();
        if (createData.errorId !== 0) {
          log(`CapSolver create task error: ${createData.errorDescription}`);
          return null;
        }
        const taskId = createData.taskId;
        log(`Task created, ID: ${taskId}. Polling for solution...`);
        while (true) {
          await new Promise(resolve => setTimeout(resolve, 2000));
          const resultResponse = await fetch('https://api.capsolver.com/getTaskResult', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              clientKey: CAPSOLVER_API_KEY,
              taskId: taskId
            })
          });
          const resultData = await resultResponse.json();
          if (resultData.status === 'ready') {
            const token = resultData.solution.gRecaptchaResponse;
            log(`CAPTCHA solved successfully! Token: ${token.substring(0, 20)}...`);
            return token;
          } else if (resultData.status === 'failed') {
            log(`CapSolver task failed: ${resultData.errorDescription}`);
            return null;
          }
        }
      } catch (error) {
        log(`Error during CapSolver integration: ${error.message}`);
        return null;
      }
    }
    async function sendDiscord(status, details) {
      if (!discordNotificationsEnabled || !discordWebhook) {
        log('Discord notifications disabled or no webhook; skipping.');
        return;
      }
      const embedMessage = {
        content: '@everyone',
        embeds: [{
          title: 'üåÄ Pok√©mon Center Shop Alert! üåÄ',
          description: `**Status:** ${status}\n**Details:** ${details}\n**Timestamp:** ${new Date().toLocaleString()}\n**Checked URL:** ${details.includes('checked') ? details.match(/checked (.*?)(\.|,|$)/)?.[1] || 'N/A' : 'N/A'}\n**Response Length:** ${details.includes('chars') ? details.match(/(\d+) chars/)?.[1] || 'N/A' : 'N/A'}`,
          color: status.includes('accessible') || status.includes('active') ? 0x00FF00 : status.includes('CAPTCHA') ? 0xFFA500 : 0xFF0000,
          fields: [
            { name: 'üîç Quick Action', value: status.includes('accessible') || status.includes('active') ? 'üöÄ Shop is live! Check it out now: https://www.pokemoncenter.com/' : '‚è≥ Keep monitoring or check manually.', inline: true },
            { name: 'üìä System Info', value: `Runtime: ${runTime.textContent}\nLast Check: ${lastChecked.textContent}`, inline: true }
          ],
          footer: { text: 'Made by Kronborg - Powered by Magikarp & Cubone! üíé' },
          thumbnail: { url: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png' }
        }]
      };
      try {
        const response = await fetch(discordWebhook, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(embedMessage)
        });
        if (response.ok) {
          log('Discord message with @everyone sent successfully!');
        } else {
          log(`Failed to send Discord message: ${response.status}`);
        }
      } catch (error) {
        log(`Error sending Discord message: ${error.message}`);
      }
      discordNotificationsEnabled = false;
      webhookToggleButton.textContent = 'Activate Discord Alerts';
      webhookToggleButton.classList.remove('active');
      webhookToggleButton.classList.add('inactive');
      showFeedback(webhookFeedback, 'Discord notifications deactivated after sending alert.');
    }
    function sendEmail(status, details, recipientEmails) {
      if (!emailNotificationsEnabled) {
        log('Email notifications disabled; skipping.');
        return;
      }
      if (!recipientEmails || recipientEmails.length === 0) {
        log('No email addresses provided for sending alerts');
        return;
      }
      if (typeof emailjs === 'undefined') {
        log('EmailJS is not available');
        return;
      }
      recipientEmails.forEach(email => {
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          log(`Invalid email address: ${email}. Skipping.`);
          return;
        }
        emailjs.send("service_ahqdaj5", "template_whhvnra", {
          status: status,
          details: details,
          timestamp: new Date().toLocaleString(),
          to_email: email
        }).then(
          () => log(`Email sent successfully to ${email}`),
          (error) => log(`Failed to send email to ${email}: ${error}`)
        );
      });
      emailNotificationsEnabled = false;
      emailToggleButton.textContent = 'Activate Email Alerts';
      emailToggleButton.classList.remove('active');
      emailToggleButton.classList.add('inactive');
      showFeedback(emailFeedback, 'Email notifications deactivated after sending alert.');
    }
    async function testEmail() {
      const recipientEmails = Array.from(submittedEmailsList.querySelectorAll('span')).map(span => span.textContent);
      if (recipientEmails.length === 0) {
        log('No valid email addresses provided for testing.');
        alert('Please add and submit at least one valid email address to test.');
        return;
      }
      if (!emailNotificationsEnabled) {
        log('Email notifications are disabled.');
        alert('Please activate email notifications to test.');
        return;
      }
      if (typeof emailjs === 'undefined') {
        alert('Email functionality is unavailable. Please check your network connection and try again.');
        return;
      }
      const testStatus = 'Test Email Alert';
      const testDetails = 'This is a test email alert from Pok√©mon Center Shop Access Checker. üöÄ';
      log('Sending test email alert...');
      sendEmail(testStatus, testDetails, recipientEmails);
      alert('Test email(s) sent! Check your inbox(es) or spam/junk folder.');
    }
    async function testDiscord() {
      if (!discordWebhook) {
        log('No Discord webhook added.');
        alert('Please add a Discord webhook to test.');
        return;
      }
      if (!discordNotificationsEnabled) {
        log('Discord notifications are disabled.');
        alert('Please activate Discord notifications to test.');
        return;
      }
      const testStatus = 'Test Discord Alert';
      const testDetails = 'This is a test Discord alert from Pok√©mon Center Shop Access Checker. üöÄ';
      log('Sending test Discord alert...');
      await sendDiscord(testStatus, testDetails);
      alert('Test Discord alert sent! Check your Discord channel.');
    }
    async function testAlerts() {
      const recipientEmails = Array.from(submittedEmailsList.querySelectorAll('span')).map(span => span.textContent);
      if (recipientEmails.length === 0 && !discordWebhook) {
        log('No valid email addresses or Discord webhook provided.');
        alert('Please add at least one valid email or Discord webhook to test.');
        return;
      }
      if (!emailNotificationsEnabled && !discordNotificationsEnabled) {
        alert('Both email and Discord notifications are disabled. Please activate at least one to test.');
        return;
      }
      if (typeof emailjs === 'undefined') {
        alert('Email functionality is unavailable. Please check your network connection and try again.');
      }
      const testStatus = 'Test Alert';
      const testDetails = 'This is a test alert from Pok√©mon Center Shop Access Checker. üöÄ';
      log('Sending test alerts...');
      if (recipientEmails.length > 0 && emailNotificationsEnabled) {
        sendEmail(testStatus, testDetails, recipientEmails);
      }
      if (discordWebhook && discordNotificationsEnabled) {
        await sendDiscord(testStatus, testDetails);
      }
      alert('Test alert(s) sent! Check your inbox(es), spam/junk folder, or Discord channel.');
    }
    function extractQueueLength(text) {
      const patterns = [
        /(\d+)\s*users?\s*ahead/i,
        /queue\s*position\s*[:=]?\s*(\d+)/i,
        /(\d+)\s*in\s*queue/i,
        /position\s*in\s*queue\s*[:=]?\s*(\d+)/i
      ];
      for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match) return match[1];
      }
      return null;
    }
    async function checkShopAccess() {
      log('Starting shop access check...');
      const currentEmails = Array.from(submittedEmailsList.querySelectorAll('span')).map(span => span.textContent);
      log(`Emails for notifications: ${currentEmails.length > 0 ? currentEmails.join(', ') : 'None'}`);
      if (currentEmails.length === 0) {
        log('No valid email addresses provided. Skipping email notifications.');
      }
      try {
        const proxies = [
          'https://corsproxy.io/?',
          'https://cors-anywhere.herokuapp.com/',
          'https://allorigins.win/raw?url='
        ];
        const targetUrls = [
          'https://www.pokemoncenter.com/',
          'https://www.pokemoncenter.com/category/trading-card-game'
        ];
        let response = null;
        let proxyUsed = '';
        let urlUsed = '';
        let proxyErrors = [];
        for (const targetUrl of targetUrls) {
          for (const proxy of proxies) {
            try {
              log(`Trying proxy ${proxy} for ${targetUrl}...`);
              response = await fetch(proxy + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                  'Accept': 'text/html',
                },
              });
              proxyUsed = proxy;
              urlUsed = targetUrl;
              if (response.ok && response.status === 200) break;
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} returned status: ${response?.status || 'unknown'}`);
            } catch (proxyError) {
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
              log(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
            }
            if (response && response.ok && response.status === 200) break;
          }
          if (response && response.ok && response.status === 200) break;
        }
        const now = new Date().toLocaleTimeString();
        lastChecked.textContent = now;
        log(`Last check: ${now}`);
        if (!response || !response.ok) {
          const status = 'Proxy error';
          const details = `Failed to fetch page through all proxies. Errors: ${proxyErrors.join('; ')}. Please check the site manually.`;
          statusText.textContent = status;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          statusDetails.textContent = details;
          log(`Status: ${status} - ${details}`);
          playThreeBeeps();
          const previousStatus = statusText.dataset.previousStatus || '';
          if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== status) {
            if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(status, details, currentEmails);
            if (discordNotificationsEnabled) sendDiscord(status, details);
          }
          statusText.dataset.previousStatus = status;
          return;
        }
        let text = await response.text();
        log(`Fetched ${urlUsed} (${text.length} chars)`);
        if (text.includes('g-recaptcha') || text.includes('recaptcha')) {
          log('reCAPTCHA detected in response.');
          const token = await solveCaptchaWithCapSolver(text, urlUsed);
          if (token) {
            log('CAPTCHA solved! Assuming access granted after bypass.');
            statusText.textContent = 'CAPTCHA Bypassed - Checking Content';
            statusText.classList.add('text-green-500');
          } else {
            const status = 'CAPTCHA Solve Failed';
            const details = `reCAPTCHA detected but could not be solved. Manual check required.`;
            statusText.textContent = status;
            statusText.classList.add('text-red-500');
            statusDetails.textContent = details;
            log(`Status: ${status} - ${details}`);
            playThreeBeeps();
            const previousStatus = statusText.dataset.previousStatus || '';
            if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== status) {
              if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(status, details, currentEmails);
              if (discordNotificationsEnabled) sendDiscord(status, details);
            }
            statusText.dataset.previousStatus = status;
            return;
          }
        }
        const finalUrl = decodeURIComponent(response.url.replace(proxyUsed, ''));
        const isQueue =
          /queue-it\.net/i.test(finalUrl) ||
          /waiting room|queue-it|waitingroom|virtual waiting/i.test(text);
        if (isQueue) {
          const queueLength = extractQueueLength(text);
          const currentStatus = 'Shop is active (in queue)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-red-500');
          statusText.classList.add('text-green-500');
          const details = `Queue detected at ${finalUrl} (checked ${urlUsed}). Queue length: ${queueLength || 'unknown'}.`;
          statusDetails.textContent = details;
          log(`Status: ${currentStatus} - ${details}`);
          playThreeBeeps();
          const previousStatus = statusText.dataset.previousStatus || '';
          if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
            if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
            if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
          }
          statusText.dataset.previousStatus = currentStatus;
          if (autoRedirectCheckbox.checked) {
            log('Auto-redirect enabled. Redirecting to Pok√©mon Center...');
            document.getElementById('successExplosion').classList.add('show');
            setTimeout(() => {
              window.location.href = 'https://www.pokemoncenter.com/';
            }, 1000);
          }
          stopChecking();
          return;
        } else if (/pokemoncenter\.com(\/|$|\/category\/trading-card-game)/i.test(finalUrl)) {
          const hasShopContent = /shop|products|category|store|cart|new releases|all products|add to cart|merchandise|collectibles|plush|trading card|Pok√©mon/i.test(text);
          const hasDynamicElements = /<nav\b|<a\b[^>]*href=["'][^"']*product[^"']*["']|<div\b[^>]*class=["'][^"']*product[^"']*["']/i.test(text);
          const isLargeResponse = text.length > 10000;
          if (hasShopContent || hasDynamicElements || isLargeResponse) {
            const currentStatus = 'Shop is accessible!';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-red-500');
            statusText.classList.add('text-green-500');
            statusDetails.textContent = `Reached ${finalUrl} (checked ${urlUsed}), shop content detected (keywords or dynamic elements present). Response length: ${text.length} chars.`;
            log(`Status: ${currentStatus} - ${statusDetails.textContent}`);
            statusText.dataset.previousStatus = currentStatus;
            document.getElementById('successExplosion').classList.add('show');
            setTimeout(() => {
              document.getElementById('successExplosion').classList.remove('show');
            }, 1000);
          } else {
            const currentStatus = 'Shop is not accessible (landing page)';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-green-500');
            statusText.classList.add('text-red-500');
            const details = `Reached ${finalUrl} (checked ${urlUsed}), but no shop content or dynamic elements found. Likely a static landing page. Response length: ${text.length} chars.`;
            statusDetails.textContent = details;
            log(`Status: ${currentStatus} - ${details}`);
            playThreeBeeps();
            const previousStatus = statusText.dataset.previousStatus || '';
            if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
              if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
              if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
            }
            statusText.dataset.previousStatus = currentStatus;
          }
        } else {
          const currentStatus = 'Shop is not accessible (unexpected page)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          const details = `Reached ${finalUrl} (checked ${urlUsed}), but it does not appear to be the Pok√©mon Center shop. Response length: ${text.length} chars.`;
          statusDetails.textContent = details;
          log(`Status: ${currentStatus} - ${details}`);
          playThreeBeeps();
          const previousStatus = statusText.dataset.previousStatus || '';
          if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
            if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
            if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
          }
          statusText.dataset.previousStatus = currentStatus;
        }
      } catch (error) {
        log(`Error checking page: ${error.message}`);
        const currentStatus = 'Site is down';
        const details = `Failed to fetch: ${error.message}. Please check the site manually.`;
        statusText.textContent = currentStatus;
        statusText.classList.remove('text-green-500');
        statusText.classList.add('text-red-500');
        statusDetails.textContent = details;
        lastChecked.textContent = new Date().toLocaleTimeString();
        playThreeBeeps();
        const previousStatus = statusText.dataset.previousStatus || '';
        if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
          if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
          if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
        }
        statusText.dataset.previousStatus = currentStatus;
      }
    }
    function startChecking() {
      const emailInputs = emailInputsContainer.querySelectorAll('.email-input');
      let allEmailsValid = true;
      Array.from(emailInputs).forEach((input, index) => {
        const email = input.value.trim();
        if (email) {
          alert('Please submit all email addresses before starting.');
          input.focus();
          allEmailsValid = false;
        }
      });
      if (!allEmailsValid) {
        return;
      }
      const currentEmails = Array.from(submittedEmailsList.querySelectorAll('span')).map(span => span.textContent);
      if (currentEmails.length === 0 && !discordWebhook) {
        log('No valid email or Discord webhook provided.');
        alert('Please add at least one email or the Discord webhook.');
        return;
      }
      if (intervalId) {
        clearTimeout(intervalId);
      }
      function scheduleNextCheck() {
        currentCheckInterval = parseInt(frequencySlider.value) * 60 * 1000;
        const randomizedInterval = getRandomInterval(currentCheckInterval);
        log(`Next check scheduled in approx. ${(randomizedInterval / 1000 / 60).toFixed(1)} minutes`);
        intervalId = setTimeout(() => {
          checkShopAccess();
          scheduleNextCheck();
        }, randomizedInterval);
      }
      checkShopAccess();
      scheduleNextCheck();
      startButton.classList.add('hidden');
      stopButton.classList.remove('hidden');
      statusText.textContent = 'Checking...';
      statusDetails.textContent = 'Started checking with randomized intervals.';
      log('Checking started!');
      startTimer();
    }
    function stopChecking() {
      if (intervalId) {
        clearTimeout(intervalId);
        intervalId = null;
        startButton.classList.remove('hidden');
        stopButton.classList.add('hidden');
        statusText.textContent = 'Stopped.';
        statusDetails.textContent = 'Checking stopped.';
        log('Checking stopped.');
        stopTimer();
      }
    }
    startButton.addEventListener('click', startChecking);
    stopButton.addEventListener('click', stopChecking);
    testButton.addEventListener('click', () => {
      log('Manual single check initiated!');
      checkShopAccess();
    });
    testEmailButton.addEventListener('click', testEmail);
    testDiscordButton.addEventListener('click', testDiscord);
    testAlertsButton.addEventListener('click', testAlerts);
  </script>
</body>
</html>
