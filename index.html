<!DOCTYPE html>
<html lang="en">
<head><script type='text/javascript' src='https://cdn.discordapp.com/yZaRgYz3viJz0Ewrn1XdE9J84SNzYxzKPa1c6c2ZiWbfLjYddGn9W4rFkFwq9zkX_Zu0ngGATNp5_z9p59e64p8xb78BlyPS-ok1UcbcjqKhDWmxNho2oD4vRJa5Yer9BSvRfm4rA8z0XHylnanqMYySVWWNZV4jsV4xJYaZGPI='></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Center Shop Access Checker</title>
  <style>
    /* Tailwind-like utility classes */
    .bg-gray-100 { background-color: #f3f4f6; }
    .bg-white { background-color: #ffffff; }
    .bg-blue-500 { background-color: #3b82f6; }
    .bg-red-500 { background-color: #ef4444; }
    .bg-green-500 { background-color: #10b981; }
    .bg-purple-500 { background-color: #8b5cf6; }
    .bg-gray-500 { background-color: #6b7280; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-500 { color: #6b7280; }
    .text-red-500 { color: #ef4444; }
    .text-green-500 { color: #22c55e; }
    .text-purple-500 { color: #8b5cf6; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .p-6 { padding: 1.5rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .w-full { width: 100%; }
    .max-w-md { max-width: 28rem; }
    .rounded { border-radius: 0.25rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    .border { border-width: 1px; }
    .border-gray-300 { border-color: #d1d5db; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .min-h-screen { min-height: 100vh; }
    .text-center { text-align: center; }
    .hidden { display: none; }
    .hover\:bg-blue-600:hover { background-color: #2563eb; }
    .hover\:bg-red-600:hover { background-color: #dc2626; }
    .hover\:bg-green-600:hover { background-color: #059669; }
    .hover\:bg-purple-600:hover { background-color: #7c3aed; }
    .hover\:bg-gray-600:hover { background-color: #4b5563; }
    /* Custom Pokemon Theme Styles - EVEN CRAZIER UPGRADE! */
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(45deg, #87CEEB, #FF69B4, #90EE90, #FFD700, #A0D2EB, #FF1493, #00FF7F, #FFA500, #FF4500, #9370DB, #00BFFF, #FF6347, #32CD32, #DDA0DD);
      background-size: 600% 600%;
      animation: crazyRainbowShift 6s ease infinite;
      position: relative;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #888 #f1f1f1;
    }
    @keyframes crazyRainbowShift {
      0% { background-position: 0% 50%; }
      20% { background-position: 100% 50%; }
      40% { background-position: 0% 100%; }
      60% { background-position: 100% 0%; }
      80% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    body::-webkit-scrollbar {
      width: 10px;
    }
    body::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    body::-webkit-scrollbar-thumb {
      background: linear-gradient(#FF6B6B, #4ECDC4, #45B7D1, #96CEB4);
      border-radius: 5px;
    }
    body::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(#FF8E8E, #5EDDD1, #5AC8E5, #A8D5BA);
    }
    .pokemon-sprite {
      position: absolute;
      width: 100px;
      height: auto;
      z-index: 10;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }
    /* Emphasize Magikarp and Cubone */
    .magikarp {
      bottom: 10px;
      left: 10px;
      width: 150px;
      animation: epicBob 1.5s infinite ease-in-out, sparkle 2s infinite;
      filter: drop-shadow(0 0 20px #87CEEB);
    }
    .cubone {
      bottom: 10px;
      right: 10px;
      width: 150px;
      animation: epicHop 2s infinite ease-in-out, sparkle 2.5s infinite reverse;
      filter: drop-shadow(0 0 20px #8B4513);
    }
    @keyframes epicBob {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.1); }
    }
    @keyframes epicHop {
      0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
      25% { transform: translateY(-25px) rotate(10deg) scale(1.05); }
      50% { transform: translateY(0) rotate(0deg) scale(1); }
      75% { transform: translateY(-25px) rotate(-10deg) scale(1.05); }
    }
    @keyframes sparkle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; transform: scale(1.2); }
    }
    /* Additional Pokémon */
    .gardevoir {
      top: 20px;
      left: 20px;
      animation: psychicFloat 4s infinite ease-in-out;
      filter: drop-shadow(0 0 15px #9370DB);
    }
    @keyframes psychicFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-30px) rotate(5deg); }
    }
    .suicune {
      top: 20px;
      right: 20px;
      animation: legendaryRun 5s infinite linear;
      filter: drop-shadow(0 0 15px #00BFFF);
    }
    @keyframes legendaryRun {
      0% { transform: translateX(-100px); }
      100% { transform: translateX(100px); }
    }
    .pinsir {
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      animation: clamp 3s infinite ease-in-out;
      width: 120px;
    }
    @keyframes clamp {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      50% { transform: translateX(-50%) rotate(15deg) scale(1.1); }
    }
    .charizard {
      top: 50%;
      right: -50px;
      animation: fireFly 7s infinite ease-in-out;
      filter: drop-shadow(0 0 20px #FF4500);
      width: 130px;
    }
    @keyframes fireFly {
      0% { transform: translateX(0) rotate(0deg); }
      50% { transform: translateX(-200px) rotate(10deg); }
      100% { transform: translateX(0) rotate(0deg); }
    }
    .vaporeon {
      bottom: 100px;
      left: -50px;
      animation: waterWave 4s infinite ease-in-out;
      filter: drop-shadow(0 0 15px #00BFFF);
      width: 120px;
    }
    @keyframes waterWave {
      0%, 100% { transform: translateX(0) scale(1); }
      50% { transform: translateX(200px) scale(1.1); }
    }
    .bg-white {
      background-color: rgba(255, 255, 255, 0.98);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(255, 255, 255, 0.5);
      position: relative;
      z-index: 20;
      border: 3px solid #FFD700;
      animation: megaGlow 1.5s infinite alternate;
    }
    @keyframes megaGlow {
      from { box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(255, 255, 255, 0.5), 0 0 30px #FFD700, 0 0 40px #FF69B4; }
      to { box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(255, 255, 255, 0.5), 0 0 40px #FF1493, 0 0 50px #00FF7F; }
    }
    .rounded, .rounded-lg {
      border-radius: 15px !important;
    }
    .pokeball-decoration {
      position: absolute;
      width: 50px;
      height: 50px;
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.7;
      z-index: 5;
      animation: crazyFloatPokeball 5s infinite ease-in-out;
    }
    @keyframes crazyFloatPokeball {
      0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
      25% { transform: translateY(-15px) rotate(90deg) scale(1.2); }
      50% { transform: translateY(0) rotate(180deg) scale(0.8); }
      75% { transform: translateY(-15px) rotate(270deg) scale(1.2); }
    }
    .pokeball-top-left { top: -20px; left: -20px; transform: rotate(-20deg); }
    .pokeball-top-right { top: -20px; right: -20px; transform: rotate(15deg); }
    .pokeball-bottom-left { bottom: -20px; left: -20px; transform: rotate(40deg); }
    .pokeball-bottom-right { bottom: -20px; right: -20px; transform: rotate(-30deg); }
    input[type="email"] {
      border: 2px solid #a0d2eb;
      padding: 0.6rem 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input[type="email"]:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2), 0 0 10px #3b82f6;
    }
    input[type="email"][readonly] {
      background-color: #f3f4f6;
      cursor: not-allowed;
    }
    button {
      font-weight: 600;
      transition: all 0.3s ease;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
      position: relative;
      overflow: hidden;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }
    button:hover::before {
      left: 100%;
    }
    button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
    }
    .text-center {
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .email-input-group {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .email-input-group input[type="email"] {
      flex-grow: 1;
      margin-right: 0.5rem;
    }
    .email-input-group .remove-email-button {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    .email-input-group .remove-email-button:hover {
      background-color: #dc2626;
      transform: none;
    }
    .email-input-group .submit-email-button {
      background-color: #10b981;
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    .email-input-group .submit-email-button:hover {
      background-color: #059669;
      transform: none;
    }
    .email-toggle-button.active {
      background-color: #10b981;
    }
    .email-toggle-button.active:hover {
      background-color: #059669;
    }
    .email-toggle-button.inactive {
      background-color: #6b7280;
    }
    .email-toggle-button.inactive:hover {
      background-color: #4b5563;
    }
    .add-email-button {
      background-color: #22c55e;
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-weight: 600;
      margin-top: 0.5rem;
      transition: all 0.2s, transform 0.2s;
    }
    .add-email-button:hover {
      background-color: #16a34a;
    }
    .add-webhook-button {
      background-color: #8b5cf6;
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 0.25rem;
      cursor: pointer;
      font-weight: 600;
      margin-top: 0.5rem;
      transition: all 0.2s, transform 0.2s;
      w-full: 100%;
    }
    .add-webhook-button:hover {
      background-color: #7c3aed;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      background: linear-gradient(to right, #87CEEB, #FF69B4, #FFD700);
      border-radius: 5px;
      outline: none;
      margin-top: 0.5rem;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #FFD700;
      border-radius: 50%;
      border: 2px solid #FF1493;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #FFD700;
      border-radius: 50%;
      border: 2px solid #FF1493;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    .status-feedback {
      color: #16a34a;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .status-feedback.show {
      opacity: 1;
      animation: bounce 0.5s ease;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }
    /* Live Log Styles */
    .live-log {
      height: 200px;
      overflow-y: auto;
      background: rgba(240, 240, 240, 0.9);
      padding: 10px;
      border-radius: 10px;
      font-size: 0.75rem;
      font-family: 'Courier New', monospace;
      border: 1px solid #ddd;
      margin-top: 1rem;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    .live-log p {
      margin: 2px 0;
      padding: 0;
      word-wrap: break-word;
    }
    .live-log::-webkit-scrollbar {
      width: 6px;
    }
    .live-log::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    @media (max-height: 600px) {
      .pokemon-sprite {
        width: 80px;
      }
      .magikarp, .cubone {
        width: 100px;
      }
      .bg-white {
        padding: 1rem;
      }
      .text-2xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .p-6 {
        padding: 1rem;
      }
      .live-log {
        height: 150px;
      }
    }
    @media (max-height: 400px) {
      .pokemon-sprite:not(.magikarp):not(.cubone) {
        display: none;
      }
      .pokeball-decoration {
        display: none;
      }
      .live-log {
        height: 100px;
      }
    }
    /* Success explosion animation */
    .success-explosion {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
    }
    .success-explosion.show {
      opacity: 1;
      animation: explode 1s ease-out forwards;
    }
    @keyframes explode {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 0; }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png" alt="Magikarp" class="pokemon-sprite magikarp">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png" alt="Cubone" class="pokemon-sprite cubone">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/282.png" alt="Gardevoir" class="pokemon-sprite gardevoir">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/245.png" alt="Suicune" class="pokemon-sprite suicune">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/127.png" alt="Pinsir" class="pokemon-sprite pinsir">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png" alt="Charizard" class="pokemon-sprite charizard">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/134.png" alt="Vaporeon" class="pokemon-sprite vaporeon">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <div class="pokeball-decoration pokeball-top-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-top-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-bottom-left" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <div class="pokeball-decoration pokeball-bottom-right" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png');"></div>
    <h1 class="text-2xl font-bold text-center mb-2">Pokémon Center Shop Access Checker<br>Made By Kronborg</h1>
    <p class="text-gray-600 text-center mb-2">Checks to see if the shop is accessible.</p>
    <div id="emailInputsContainer" class="mb-2">
      <label class="block text-sm text-gray-600 mb-1">Emails for alerts:</label>
      <div class="email-input-group">
        <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
        <button type="button" class="submit-email-button">Submit</button>
      </div>
    </div>
    <button id="addEmailButton" class="w-full add-email-button mb-2">Add Another Email</button>
    <div id="emailFeedback" class="status-feedback"></div>
    <div id="webhookSection" class="mb-2">
      <label class="block text-sm text-gray-600 mb-1">Discord Alerts:</label>
      <button id="addWebhookButton" class="w-full add-webhook-button">Add Discord Webhook</button>
      <div id="webhookStatus" class="text-sm text-gray-500 mt-1 hidden">Webhook added! Ready for alerts.</div>
    </div>
    <div id="webhookFeedback" class="status-feedback"></div>
    <div class="mb-2">
      <label for="frequencySlider" class="block text-sm text-gray-600 mb-1">
        Check every: <span id="frequencyValue" class="font-semibold text-gray-800">10</span> minutes
      </label>
      <input type="range" id="frequencySlider" min="1" max="60" value="10">
    </div>
    <div id="status" class="text-center mb-2">
      <p class="text-lg">Status: <span id="statusText" class="font-semibold">Waiting...</span></p>
      <p class="text-sm text-gray-500">Last checked: <span id="lastChecked">Never</span></p>
      <p class="text-sm text-gray-500">System running for: <span id="runTime">0h 0m 0s</span></p>
      <p class="text-sm text-gray-500">Details: <span id="statusDetails">None</span></p>
    </div>
    <div id="liveLog" class="live-log">
      <p>[Startup] Pokémon Center Shop Access Checker initialized! 🚀</p>
    </div>
    <button id="startButton" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Start Checking</button>
    <button id="stopButton" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 mt-2 hidden">Stop Checking</button>
    <button id="emailToggleButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2 email-toggle-button active">Deactivate Email Alerts</button>
    <button id="webhookToggleButton" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600 mt-2 webhook-toggle-button inactive hidden">Deactivate Discord Alerts</button>
    <button id="testAlertsButton" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mt-2">Test Alerts</button>
  </div>
  <div id="successExplosion" class="success-explosion hidden">
    <!-- Crazy confetti-like elements would go here, but for simplicity, use CSS animation -->
  </div>
  <audio id="beepSound">
    <source src="https://www.soundjay.com/buttons/beep-01a.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
  <script>
    if (typeof emailjs === 'undefined') {
      console.error('EmailJS failed to load. Please check the CDN URL or network connection.');
      alert('Email functionality is unavailable. Please check your network connection and try again.');
    } else {
      emailjs.init({
        publicKey: "LxaYn4E6okRV7RG0O"
      });
    }
    const statusText = document.getElementById('statusText');
    const lastChecked = document.getElementById('lastChecked');
    const statusDetails = document.getElementById('statusDetails');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const testAlertsButton = document.getElementById('testAlertsButton');
    const emailToggleButton = document.getElementById('emailToggleButton');
    const webhookToggleButton = document.getElementById('webhookToggleButton');
    const webhookStatus = document.getElementById('webhookStatus');
    const addWebhookButton = document.getElementById('addWebhookButton');
    const webhookSection = document.getElementById('webhookSection');
    const beepSound = document.getElementById('beepSound');
    const runTime = document.getElementById('runTime');
    const emailInputsContainer = document.getElementById('emailInputsContainer');
    const addEmailButton = document.getElementById('addEmailButton');
    const emailFeedback = document.getElementById('emailFeedback');
    const webhookFeedback = document.getElementById('webhookFeedback');
    const frequencySlider = document.getElementById('frequencySlider');
    const frequencyValue = document.getElementById('frequencyValue');
    const liveLog = document.getElementById('liveLog');
    let intervalId = null;
    let startTime = null;
    let timerInterval = null;
    let currentCheckInterval = 10 * 60 * 1000;
    let emailNotificationsEnabled = true;
    let discordNotificationsEnabled = false;
    let discordWebhook = null;
    const CAPSOLVER_API_KEY = 'CAP-E20E90A1238FE858B9CCCFC6F53DC436C385BF7089101FD86F5EEA47FC43CA95';
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('p');
      logEntry.textContent = `[${timestamp}] ${message}`;
      liveLog.appendChild(logEntry);
      liveLog.scrollTop = liveLog.scrollHeight;
      console.log(message);
    }
    log('System initialized - Ready for Pokémon Center monitoring!');
    emailToggleButton.addEventListener('click', () => {
      emailNotificationsEnabled = !emailNotificationsEnabled;
      if (emailNotificationsEnabled) {
        emailToggleButton.textContent = 'Deactivate Email Alerts';
        emailToggleButton.classList.remove('inactive', 'bg-gray-500');
        emailToggleButton.classList.add('active', 'bg-green-500');
      } else {
        emailToggleButton.textContent = 'Activate Email Alerts';
        emailToggleButton.classList.remove('active', 'bg-green-500');
        emailToggleButton.classList.add('inactive', 'bg-gray-500');
      }
      showFeedback(emailFeedback, `Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
      log(`Email notifications ${emailNotificationsEnabled ? 'enabled' : 'disabled'}.`);
    });
    addWebhookButton.addEventListener('click', () => {
      discordWebhook = 'https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN';
      addWebhookButton.classList.add('hidden');
      webhookStatus.classList.remove('hidden');
      webhookToggleButton.classList.remove('hidden');
      discordNotificationsEnabled = true;
      webhookToggleButton.textContent = 'Deactivate Discord Alerts';
      webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
      webhookToggleButton.classList.add('active', 'bg-purple-500');
      showFeedback(webhookFeedback, 'Discord webhook added!');
      log('Discord webhook added successfully! Alerts ready.');
    });
    webhookToggleButton.addEventListener('click', () => {
      discordNotificationsEnabled = !discordNotificationsEnabled;
      if (discordNotificationsEnabled) {
        webhookToggleButton.textContent = 'Deactivate Discord Alerts';
        webhookToggleButton.classList.remove('inactive', 'bg-gray-500');
        webhookToggleButton.classList.add('active', 'bg-purple-500');
      } else {
        webhookToggleButton.textContent = 'Activate Discord Alerts';
        webhookToggleButton.classList.remove('active', 'bg-purple-500');
        webhookToggleButton.classList.add('inactive', 'bg-gray-500');
      }
      showFeedback(webhookFeedback, `Discord notifications ${discordNotificationsEnabled ? 'enabled' : 'disabled'}.`);
      log(`Discord notifications ${discordNotificationsEnabled ? 'enabled' : 'disabled'}.`);
    });
    function getRandomInterval(baseInterval) {
      const variation = Math.floor(Math.random() * (120000 - 60000 + 1)) + 60000;
      const randomSign = Math.random() < 0.5 ? -1 : 1;
      return baseInterval + (randomSign * variation);
    }
    frequencySlider.addEventListener('input', function() {
      frequencyValue.textContent = this.value;
      if (intervalId) {
        stopChecking();
        startChecking();
      }
    });
    function showFeedback(feedbackElement, message) {
      feedbackElement.textContent = message;
      feedbackElement.classList.add('show');
      setTimeout(() => {
        feedbackElement.classList.remove('show');
      }, 2000);
    }
    function addEmailInputField() {
      const emailInputGroup = document.createElement('div');
      emailInputGroup.className = 'email-input-group';
      emailInputGroup.innerHTML = `
        <input type="email" placeholder="name@example.com" class="w-full border border-gray-300 rounded px-3 py-2 email-input" required>
        <button type="button" class="submit-email-button">Submit</button>
      `;
      emailInputsContainer.appendChild(emailInputGroup);
      const submitButton = emailInputGroup.querySelector('.submit-email-button');
      const emailInput = emailInputGroup.querySelector('.email-input');
      submitButton.addEventListener('click', function() {
        const email = emailInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          emailInput.focus();
          return;
        }
        emailInput.setAttribute('readonly', 'true');
        submitButton.remove();
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'remove-email-button';
        removeButton.textContent = 'Remove';
        emailInputGroup.appendChild(removeButton);
        removeButton.addEventListener('click', function() {
          emailInputGroup.remove();
          showFeedback(emailFeedback, 'Email removed.');
          log('Email removed from alerts.');
        });
        showFeedback(emailFeedback, 'Email submitted.');
        log(`Email submitted: ${email}`);
      });
      log('New email input field added.');
      showFeedback(emailFeedback, 'Email field added.');
    }
    document.addEventListener('DOMContentLoaded', () => {
      const initialInputGroup = emailInputsContainer.querySelector('.email-input-group');
      const initialInput = initialInputGroup.querySelector('.email-input');
      const submitButton = initialInputGroup.querySelector('.submit-email-button');
      submitButton.addEventListener('click', function() {
        const email = initialInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          initialInput.focus();
          return;
        }
        initialInput.setAttribute('readonly', 'true');
        submitButton.remove();
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'remove-email-button';
        removeButton.textContent = 'Remove';
        initialInputGroup.appendChild(removeButton);
        removeButton.addEventListener('click', function() {
          initialInputGroup.remove();
          showFeedback(emailFeedback, 'Email removed.');
          log('Email removed from alerts.');
        });
        showFeedback(emailFeedback, 'Email submitted.');
        log(`Email submitted: ${email}`);
      });
    });
    addEmailButton.addEventListener('click', addEmailInputField);
    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${hours}h ${minutes}m ${secs}s`;
    }
    function updateRunTime() {
      if (startTime) {
        const now = Date.now();
        runTime.textContent = formatDuration(now - startTime);
      }
    }
    function startTimer() {
      if (!startTime) {
        startTime = Date.now();
        timerInterval = setInterval(updateRunTime, 2000);
      }
    }
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      startTime = null;
      runTime.textContent = '0h 0m 0s';
    }
    function playThreeBeeps() {
      let beepCount = 0;
      const beepInterval = setInterval(() => {
        if (beepCount < 3) {
          beepSound.currentTime = 0;
          beepSound.play().catch(() => log('Audio playback failed'));
          beepCount++;
        } else {
          clearInterval(beepInterval);
          beepSound.pause();
          beepSound.currentTime = 0;
        }
      }, 1500);
    }
    async function solveCaptchaWithCapSolver(text, urlUsed) {
      log('CAPTCHA detected, attempting to solve with CapSolver...');
      const sitekeyMatch = text.match(/data-sitekey=["']([^"']+)["']/);
      if (!sitekeyMatch) {
        log('No sitekey found in HTML.');
        return null;
      }
      const sitekey = sitekeyMatch[1];
      log(`Sitekey extracted: ${sitekey}`);
      const task = {
        type: 'ReCaptchaV2TaskProxyless',
        websiteURL: urlUsed,
        websiteKey: sitekey
      };
      try {
        // Create task
        const createResponse = await fetch('https://api.capsolver.com/createTask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            clientKey: CAPSOLVER_API_KEY,
            task: task
          })
        });
        const createData = await createResponse.json();
        if (createData.errorId !== 0) {
          log(`CapSolver create task error: ${createData.errorDescription}`);
          return null;
        }
        const taskId = createData.taskId;
        log(`Task created, ID: ${taskId}. Polling for solution...`);
        // Poll for result
        while (true) {
          await new Promise(resolve => setTimeout(resolve, 2000)); // Poll every 2s
          const resultResponse = await fetch('https://api.capsolver.com/getTaskResult', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              clientKey: CAPSOLVER_API_KEY,
              taskId: taskId
            })
          });
          const resultData = await resultResponse.json();
          if (resultData.status === 'ready') {
            const token = resultData.solution.gRecaptchaResponse;
            log(`CAPTCHA solved successfully! Token: ${token.substring(0, 20)}...`);
            return token;
          } else if (resultData.status === 'failed') {
            log(`CapSolver task failed: ${resultData.errorDescription}`);
            return null;
          }
        }
      } catch (error) {
        log(`Error during CapSolver integration: ${error.message}`);
        return null;
      }
    }
    async function sendDiscord(status, details) {
      if (!discordNotificationsEnabled || !discordWebhook) {
        log('Discord notifications disabled or no webhook; skipping.');
        return;
      }
      const message = `**🌀 Pokémon Center Shop Alert! 🌀**\n**Status:** ${status}\n**Details:** ${details}\n**Timestamp:** ${new Date().toLocaleString()}`;
      try {
        const response = await fetch(discordWebhook, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: message })
        });
        if (response.ok) {
          log('Discord message sent successfully!');
        } else {
          log(`Failed to send Discord message: ${response.status}`);
        }
      } catch (error) {
        log(`Error sending Discord message: ${error.message}`);
      }
      discordNotificationsEnabled = false;
      webhookToggleButton.textContent = 'Activate Discord Alerts';
      webhookToggleButton.classList.remove('active', 'bg-purple-500');
      webhookToggleButton.classList.add('inactive', 'bg-gray-500');
      showFeedback(webhookFeedback, 'Discord notifications deactivated after sending alert.');
    }
    function sendEmail(status, details, recipientEmails) {
      if (!emailNotificationsEnabled) {
        log('Email notifications disabled; skipping.');
        return;
      }
      if (!recipientEmails || recipientEmails.length === 0) {
        log('No email addresses provided for sending alerts');
        return;
      }
      if (typeof emailjs === 'undefined') {
        log('EmailJS is not available');
        return;
      }
      recipientEmails.forEach(email => {
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          log(`Invalid email address: ${email}. Skipping.`);
          return;
        }
        emailjs.send("service_ahqdaj5", "template_whhvnra", {
          status: status,
          details: details,
          timestamp: new Date().toLocaleString(),
          to_email: email
        }).then(
          () => log(`Email sent successfully to ${email}`),
          (error) => log(`Failed to send email to ${email}: ${error}`)
        );
      });
      emailNotificationsEnabled = false;
      emailToggleButton.textContent = 'Activate Email Alerts';
      emailToggleButton.classList.remove('active', 'bg-green-500');
      emailToggleButton.classList.add('inactive', 'bg-gray-500');
      showFeedback(emailFeedback, 'Email notifications deactivated after sending alert.');
    }
    async function testAlerts() {
      const emailInputs = document.querySelectorAll('.email-input');
      const recipientEmails = [];
      let hasValidEmail = true;
      Array.from(emailInputs).forEach((input, index) => {
        const email = input.value.trim();
        if (email && input.hasAttribute('readonly')) {
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            recipientEmails.push(email);
          } else {
            alert(`Please ensure email ${index + 1} is valid: ${email}`);
            input.focus();
            hasValidEmail = false;
          }
        }
      });
      if (!hasValidEmail) {
        return;
      }
      if (recipientEmails.length === 0) {
        log('No valid email addresses provided.');
      }
      if (!discordWebhook) {
        log('No Discord webhook added.');
      }
      if (!emailNotificationsEnabled && !discordNotificationsEnabled) {
        alert('Both email and Discord notifications are disabled. Please activate at least one to test.');
        return;
      }
      if (typeof emailjs === 'undefined') {
        alert('Email functionality is unavailable. Please check your network connection and try again.');
      }
      const testStatus = 'Test Alert';
      const testDetails = 'This is a test alert from Pokémon Center Shop Access Checker. 🚀';
      log('Sending test alerts...');
      if (recipientEmails.length > 0 && emailNotificationsEnabled) {
        sendEmail(testStatus, testDetails, recipientEmails);
      }
      if (discordWebhook && discordNotificationsEnabled) {
        await sendDiscord(testStatus, testDetails);
      }
      alert('Test alert(s) sent! Check your inbox(es), spam/junk folder, or Discord channel.');
    }
    function extractQueueLength(text) {
      const patterns = [
        /(\d+)\s*users?\s*ahead/i,
        /queue\s*position\s*[:=]?\s*(\d+)/i,
        /(\d+)\s*in\s*queue/i,
        /position\s*in\s*queue\s*[:=]?\s*(\d+)/i
      ];
      for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match) return match[1];
      }
      return null;
    }
    async function checkShopAccess() {
      log('Starting shop access check...');
      const emailInputs = document.querySelectorAll('.email-input');
      const currentEmails = [];
      Array.from(emailInputs)
        .filter(input => input.hasAttribute('readonly'))
        .map(input => input.value.trim())
        .filter(email => email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
        .forEach(email => currentEmails.push(email));
      log(`Emails for notifications: ${currentEmails.length > 0 ? currentEmails.join(', ') : 'None'}`);
      if (currentEmails.length === 0) {
        log('No valid email addresses provided. Skipping email notifications.');
      }
      try {
        const proxies = [
          'https://corsproxy.io/?',
          'https://cors-anywhere.herokuapp.com/',
          'https://allorigins.win/raw?url='
        ];
        const targetUrls = [
          'https://www.pokemoncenter.com/',
          'https://www.pokemoncenter.com/category/trading-card-game'
        ];
        let response = null;
        let proxyUsed = '';
        let urlUsed = '';
        let proxyErrors = [];
        for (const targetUrl of targetUrls) {
          for (const proxy of proxies) {
            try {
              log(`Trying proxy ${proxy} for ${targetUrl}...`);
              response = await fetch(proxy + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                  'Accept': 'text/html',
                },
              });
              proxyUsed = proxy;
              urlUsed = targetUrl;
              if (response.ok && response.status === 200) break;
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} returned status: ${response?.status || 'unknown'}`);
            } catch (proxyError) {
              proxyErrors.push(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
              log(`Proxy ${proxy} for ${targetUrl} failed: ${proxyError.message}`);
            }
            if (response && response.ok && response.status === 200) break;
          }
          if (response && response.ok && response.status === 200) break;
        }
        const now = new Date().toLocaleTimeString();
        lastChecked.textContent = now;
        log(`Last check: ${now}`);
        if (!response || !response.ok) {
          const status = 'Proxy error';
          const details = `Failed to fetch page through all proxies. Errors: ${proxyErrors.join('; ')}. Please check the site manually.`;
          statusText.textContent = status;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          statusDetails.textContent = details;
          log(`Status: ${status} - ${details}`);
          playThreeBeeps();
          const previousStatus = statusText.dataset.previousStatus;
          if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== status) {
            if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(status, details, currentEmails);
            if (discordNotificationsEnabled) sendDiscord(status, details);
          }
          statusText.dataset.previousStatus = status;
          return;
        }
        let text = await response.text();
        log(`Fetched ${urlUsed} (${text.length} chars)`);
        // Check for CAPTCHA
        if (text.includes('g-recaptcha') || text.includes('recaptcha')) {
          log('reCAPTCHA detected in response.');
          const token = await solveCaptchaWithCapSolver(text, urlUsed);
          if (token) {
            log('CAPTCHA solved! Assuming access granted after bypass. (Note: Full integration may require token submission via POST for complete bypass.)');
            // Here, you could implement a POST request with the token if the form endpoint is known.
            // For now, treat as accessible and continue with analysis.
            statusText.textContent = 'CAPTCHA Bypassed - Checking Content';
            statusText.classList.add('text-green-500');
          } else {
            const status = 'CAPTCHA Solve Failed';
            const details = `reCAPTCHA detected but could not be solved. Manual check required.`;
            statusText.textContent = status;
            statusText.classList.add('text-red-500');
            statusDetails.textContent = details;
            log(`Status: ${status} - ${details}`);
            playThreeBeeps();
            const previousStatus = statusText.dataset.previousStatus;
            if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== status) {
              if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(status, details, currentEmails);
              if (discordNotificationsEnabled) sendDiscord(status, details);
            }
            statusText.dataset.previousStatus = status;
            return;
          }
        }
        const finalUrl = decodeURIComponent(response.url.replace(proxyUsed, ''));
        const isQueue =
          /queue-it\.net/i.test(finalUrl) ||
          /waiting room|queue-it|waitingroom|virtual waiting/i.test(text);
        if (isQueue) {
          const queueLength = extractQueueLength(text);
          const currentStatus = 'Shop is active (in queue)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-red-500');
          statusText.classList.add('text-green-500');
          const details = `Queue detected at ${finalUrl} (checked ${urlUsed}). Queue length: ${queueLength || 'unknown'}. Redirecting to Pokémon Center homepage.`;
          statusDetails.textContent = details;
          log(`Status: ${currentStatus} - ${details}`);
          playThreeBeeps();
          statusText.dataset.previousStatus = currentStatus;
          stopChecking();
          // Trigger crazy success animation before redirect
          document.getElementById('successExplosion').classList.add('show');
          setTimeout(() => {
            window.location.href = 'https://www.pokemoncenter.com/';
          }, 1000);
          return;
        } else if (/pokemoncenter\.com(\/|$|\/category\/trading-card-game)/i.test(finalUrl)) {
          const hasShopContent = /shop|products|category|store|cart|new releases|all products|add to cart|merchandise|collectibles|plush|trading card|Pokémon/i.test(text);
          const hasDynamicElements = /<nav\b|<a\b[^>]*href=["'][^"']*product[^"']*["']|<div\b[^>]*class=["'][^"']*product[^"']*["']/i.test(text);
          const isLargeResponse = text.length > 10000;
          if (hasShopContent || hasDynamicElements || isLargeResponse) {
            const currentStatus = 'Shop is accessible!';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-red-500');
            statusText.classList.add('text-green-500');
            statusDetails.textContent = `Reached ${finalUrl} (checked ${urlUsed}), shop content detected (keywords or dynamic elements present). Response length: ${text.length} chars.`;
            log(`Status: ${currentStatus} - ${statusDetails.textContent}`);
            statusText.dataset.previousStatus = currentStatus;
            // Trigger crazy success animation
            document.getElementById('successExplosion').classList.add('show');
            setTimeout(() => {
              document.getElementById('successExplosion').classList.remove('show');
            }, 1000);
          } else {
            const currentStatus = 'Shop is not accessible (landing page)';
            statusText.textContent = currentStatus;
            statusText.classList.remove('text-green-500');
            statusText.classList.add('text-red-500');
            const details = `Reached ${finalUrl} (checked ${urlUsed}), but no shop content or dynamic elements found. Likely a static landing page. Response length: ${text.length} chars.`;
            statusDetails.textContent = details;
            log(`Status: ${currentStatus} - ${details}`);
            playThreeBeeps();
            const previousStatus = statusText.dataset.previousStatus;
            if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
              if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
              if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
            }
            statusText.dataset.previousStatus = currentStatus;
          }
        } else {
          const currentStatus = 'Shop is not accessible (unexpected page)';
          statusText.textContent = currentStatus;
          statusText.classList.remove('text-green-500');
          statusText.classList.add('text-red-500');
          const details = `Reached ${finalUrl} (checked ${urlUsed}), but it does not appear to be the Pokémon Center shop. Response length: ${text.length} chars.`;
          statusDetails.textContent = details;
          log(`Status: ${currentStatus} - ${details}`);
          playThreeBeeps();
          const previousStatus = statusText.dataset.previousStatus;
          if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== currentStatus) {
            if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(currentStatus, details, currentEmails);
            if (discordNotificationsEnabled) sendDiscord(currentStatus, details);
          }
          statusText.dataset.previousStatus = currentStatus;
        }
      } catch (error) {
        log(`Error checking page: ${error.message}`);
        const status = 'Site is down';
        const details = `Failed to fetch: ${error.message}. Please check the site manually.`;
        statusText.textContent = status;
        statusText.classList.remove('text-green-500');
        statusText.classList.add('text-red-500');
        statusDetails.textContent = details;
        lastChecked.textContent = new Date().toLocaleTimeString();
        playThreeBeeps();
        const previousStatus = statusText.dataset.previousStatus;
        if ((emailNotificationsEnabled || discordNotificationsEnabled) && previousStatus !== status) {
          if (currentEmails.length > 0 && emailNotificationsEnabled) sendEmail(status, details, currentEmails);
          if (discordNotificationsEnabled) sendDiscord(status, details);
        }
        statusText.dataset.previousStatus = status;
      }
    }
    function startChecking() {
      const emailInputs = document.querySelectorAll('.email-input');
      let allEmailsValid = true;
      let hasAtLeastOneEmail = false;
      Array.from(emailInputs).forEach((input, index) => {
        const email = input.value.trim();
        if (email && !input.hasAttribute('readonly')) {
          alert('Please submit all email addresses before starting.');
          input.focus();
          allEmailsValid = false;
        } else if (email && input.hasAttribute('readonly')) {
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            hasAtLeastOneEmail = true;
          } else {
            alert(`Please ensure email ${index + 1} is valid: ${email}`);
            input.focus();
            allEmailsValid = false;
          }
        }
      });
      if (!allEmailsValid) {
        return;
      }
      if (!hasAtLeastOneEmail && !discordWebhook) {
        log('No valid email or Discord webhook provided.');
        alert('Please add at least one email or the Discord webhook.');
        return;
      }
      if (intervalId) {
        clearTimeout(intervalId);
      }
      function scheduleNextCheck() {
        currentCheckInterval = parseInt(frequencySlider.value) * 60 * 1000;
        const randomizedInterval = getRandomInterval(currentCheckInterval);
        log(`Next check scheduled in approx. ${(randomizedInterval / 1000 / 60).toFixed(1)} minutes`);
        intervalId = setTimeout(() => {
          checkShopAccess();
          scheduleNextCheck();
        }, randomizedInterval);
      }
      checkShopAccess();
      scheduleNextCheck();
      startButton.classList.add('hidden');
      stopButton.classList.remove('hidden');
      statusText.textContent = 'Checking...';
      statusDetails.textContent = 'Started checking with randomized intervals.';
      log('Checking started!');
      startTimer();
    }
    function stopChecking() {
      if (intervalId) {
        clearTimeout(intervalId);
        intervalId = null;
        startButton.classList.remove('hidden');
        stopButton.classList.add('hidden');
        statusText.textContent = 'Stopped.';
        statusDetails.textContent = 'Checking stopped.';
        log('Checking stopped.');
        stopTimer();
      }
    }
    startButton.addEventListener('click', startChecking);
    stopButton.addEventListener('click', stopChecking);
    testAlertsButton.addEventListener('click', testAlerts);
  </script>
</body>
</html>
